<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å³æ—¶ä»»åŠ¡æ‰§è¡Œå·¥å…· - è‰¾å…œå…œå„¿</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
    <style>
        :root { --primary: #007AFF; --bg: #f2f2f7; --danger: #ff3b30; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 40px; }
        .container { display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* å“ç‰Œå¤´ */
        .user-header { text-align: center; padding: 25px 0; }
        .avatar { width: 75px; height: 75px; border-radius: 50%; border: 3px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .nickname { margin: 10px 0; font-size: 19px; font-weight: 700; color: #1c1c1e; }

        /* æ ¸å¿ƒå¡ç‰‡ */
        .card { background: white; width: 92%; max-width: 420px; border-radius: 28px; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.06); box-sizing: border-box; }
        .task-item { margin-bottom: 22px; border-bottom: 1px solid #f2f2f7; padding-bottom: 12px; }
        .task-item label { display: block; font-size: 13px; color: #8e8e93; font-weight: 600; margin-bottom: 4px; }
        input[type="text"] { width: 100%; border: none; padding: 10px 0; font-size: 18px; outline: none; font-weight: 500; }
        .time-row { display: flex; align-items: center; justify-content: space-between; margin-top: 6px; font-size: 14px; }
        input[type="time"] { border: 1px solid #e5e5ea; border-radius: 8px; padding: 6px 12px; color: var(--primary); font-family: inherit; font-weight: bold; }

        /* æ“ä½œæŒ‰é’® */
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 8px; }
        button { border: none; padding: 16px; border-radius: 14px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .btn-start { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(0,122,255,0.3); }
        .btn-start.active { background: var(--danger); box-shadow: 0 4px 15px rgba(255,59,48,0.3); }
        .btn-share { background: #f2f2f7; color: #1c1c1e; }
        
        /* åº•éƒ¨ä¿¡æ¯ */
        .footer { padding: 35px 20px; text-align: center; font-size: 12px; color: #8e8e93; line-height: 2; }
        .link-text { color: var(--primary); cursor: pointer; text-decoration: none; font-weight: 600; }
        
        #shareCanvas { display: none; }
    </style>
</head>
<body>
<div class="container">
    <div class="user-header">
        <img src="https://dkfile.net/uploads/avatars/avatar_1037_2b899c87.jpeg" class="avatar">
        <div class="nickname">è‰¾å…œå…œå„¿</div>
    </div>

    <div class="card">
        <div class="task-item">
            <label>ğŸ¥‡ ç¬¬ä¸€ä»¶æœ€é‡è¦çš„äº‹</label>
            <input type="text" id="t1" placeholder="ç«‹åˆ»è¦æ‰§è¡Œçš„ä»»åŠ¡...">
            <div class="time-row"><span>æˆªæ­¢æ—¶é—´</span><input type="time" id="tm1"></div>
        </div>
        <div class="task-item">
            <label>ğŸ¥ˆ ç¬¬äºŒä»¶é‡è¦çš„äº‹</label>
            <input type="text" id="t2" placeholder="æ¥ä¸‹æ¥çš„é‡ç‚¹...">
            <div class="time-row"><span>æˆªæ­¢æ—¶é—´</span><input type="time" id="tm2"></div>
        </div>
        <div class="task-item">
            <label>ğŸ¥‰ ç¬¬ä¸‰ä»¶å¿…è¦çš„äº‹</label>
            <input type="text" id="t3" placeholder="å¿…é¡»å®Œæˆçš„ç»†èŠ‚...">
            <div class="time-row"><span>æˆªæ­¢æ—¶é—´</span><input type="time" id="tm3"></div>
        </div>
        
        <div class="btn-group">
            <button class="btn-start" id="startBtn" onclick="toggleReminder()">ç‚¹å‡»å¼€å¯å¼ºåŠ›æé†’</button>
            <button class="btn-share" onclick="generateShareImage()">ç”Ÿæˆåˆ†äº«å¡ç‰‡ (å«äºŒç»´ç )</button>
        </div>
    </div>

    <div class="footer">
        <p>ã€ŒAI ææ•ˆå·¥å…·å®˜æ–¹ QQ ç¾¤ã€<br>
           <strong class="link-text" onclick="copyQQ()">857023577</strong> (ç‚¹å‡»è‡ªåŠ¨å¤åˆ¶)</p>
        <p>æŠ€æœ¯æ”¯æŒï¼š<a href="https://t.zsxq.com/7tSuP" target="_blank" class="link-text">è‰¾å…œå…œå„¿</a> | 
           æ›´å¤šå·¥å…·ï¼š<a href="https://mp.weixin.qq.com/s/uHh9gx2sUMOOjIhKyIbx4A" target="_blank" class="link-text">ç‚¹å‡»æŸ¥çœ‹</a></p>
        <p>&copy; <span id="year"></span> è‰¾å…œå…œå„¿. ä¸“æ³¨ï¼Œå³æ˜¯ç”Ÿäº§åŠ›.</p>
    </div>
</div>

<canvas id="shareCanvas" width="600" height="900"></canvas>
<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
    const inputIds = ['t1', 't2', 't3', 'tm1', 'tm2', 'tm3'];
    let monitorInterval = null;

    // 1. åˆå§‹åŒ–ï¼šåŠ è½½ç¼“å­˜ + åŠ¨æ€å¹´ä»½
    window.onload = () => {
        document.getElementById('year').textContent = new Date().getFullYear();
        inputIds.forEach(id => {
            const savedData = localStorage.getItem(id);
            if(savedData) document.getElementById(id).value = savedData;
            
            // è‡ªåŠ¨ä¿å­˜ï¼šæ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦éƒ½å­˜å…¥æœ¬åœ°
            document.getElementById(id).addEventListener('input', (e) => {
                localStorage.setItem(id, e.target.value);
            });
        });
    };

    // 2. å¤åˆ¶åŠŸèƒ½
    function copyQQ() {
        navigator.clipboard.writeText('857023577');
        alert('QQç¾¤å·å·²å¤åˆ¶ï¼Œæ¬¢è¿åŠ å…¥äº¤æµï¼');
    }

    // 3. å¼ºåŠ›æé†’å®ç°
    function toggleReminder() {
        const btn = document.getElementById('startBtn');
        if (monitorInterval) {
            clearInterval(monitorInterval);
            monitorInterval = null;
            btn.innerText = "ç‚¹å‡»å¼€å¯å¼ºåŠ›æé†’";
            btn.classList.remove('active');
            return;
        }

        // ç”³è¯·é€šçŸ¥æƒé™
        if (!("Notification" in window)) {
            alert("æ­¤æµè§ˆå™¨ä¸æ”¯æŒæ¶ˆæ¯æé†’ã€‚");
            return;
        }

        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                btn.innerText = "æé†’ç›‘æ§ä¸­... (ç‚¹å‡»å…³é—­)";
                btn.classList.add('active');
                startMonitoring();
                alert("æé†’å·²æ¿€æ´»ï¼\n1. æˆªæ­¢å‰1å°æ—¶å°†é“ƒå£°é¢„è­¦\n2. è¶…æ—¶åæ¯5åˆ†é’Ÿæé†’ä¸€æ¬¡");
            } else {
                alert("æœªè·å¾—æƒé™ï¼Œæé†’åŠŸèƒ½æ— æ³•ç”Ÿæ•ˆã€‚");
            }
        });
    }

    function startMonitoring() {
        monitorInterval = setInterval(() => {
            const now = new Date();
            for(let i=1; i<=3; i++) {
                const title = document.getElementById('t'+i).value;
                const timeValue = document.getElementById('tm'+i).value;
                
                if(!title || !timeValue) continue;

                const [h, m] = timeValue.split(':');
                const targetTime = new Date();
                targetTime.setHours(h, m, 0);
                
                const diffMs = targetTime - now;
                const diffMin = Math.floor(diffMs / 60000);

                // è§„åˆ™ 1ï¼šæå‰ä¸€å°æ—¶é“ƒå£°æé†’
                if (diffMin === 60) {
                    triggerNotify(`é¢„è­¦ï¼šä»»åŠ¡ [${title}] è¿˜æœ‰ 1 å°æ—¶æˆªæ­¢ï¼`);
                }
                
                // è§„åˆ™ 2ï¼šè¶…æ—¶åæ¯ 5 åˆ†é’Ÿæé†’ä¸€æ¬¡
                if (diffMs <= 0) {
                    const overTimeMin = Math.abs(diffMin);
                    if (overTimeMin % 5 === 0) {
                        triggerNotify(`âš ï¸ ç«‹å³æ‰§è¡Œï¼š[${title}] å·²è¶…æ—¶ï¼ä¸è¦åˆ†å¿ƒï¼`);
                    }
                }
            }
        }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    }

    function triggerNotify(msg) {
        new Notification("ä¸“æ³¨æé†’ - è‰¾å…œå…œå„¿", { 
            body: msg, 
            icon: 'https://dkfile.net/uploads/avatars/avatar_1037_2b899c87.jpeg' 
        });
        document.getElementById('beep').play().catch(()=>{}); 
    }

    // 4. ç”Ÿæˆå¸¦äºŒç»´ç çš„åˆ†äº«å¡ç‰‡
    async function generateShareImage() {
        const canvas = document.getElementById('shareCanvas');
        const ctx = canvas.getContext('2d');
        const currentUrl = window.location.href;

        // ç»˜åˆ¶ç™½è‰²åœ†è§’å¡ç‰‡èƒŒæ™¯
        ctx.fillStyle = '#f2f2f7';
        ctx.fillRect(0,0,600,900);
        ctx.fillStyle = '#ffffff';
        drawRoundedRect(ctx, 30, 30, 540, 840, 40);
        ctx.fill();

        // ç»˜åˆ¶æ ‡é¢˜
        ctx.fillStyle = '#1c1c1e';
        ctx.font = 'bold 46px sans-serif';
        ctx.fillText('ä»Šæ—¥æœ€é‡è¦çš„ä¸‰ä»¶äº‹', 70, 130);
        
        ctx.font = '24px sans-serif';
        ctx.fillStyle = '#8e8e93';
        ctx.fillText('ä¸“æ³¨æ‰§è¡Œï¼Œæ‹’ç»æ‹–å»¶', 70, 180);

        // ç»˜åˆ¶ä»»åŠ¡åˆ—è¡¨
        ctx.font = '32px sans-serif';
        for(let i=1; i<=3; i++) {
            const task = document.getElementById('t'+i).value || 'ï¼ˆæœªè®¾ç½®ä»»åŠ¡ï¼‰';
            const time = document.getElementById('tm'+i).value || '--:--';
            
            ctx.fillStyle = '#007AFF';
            ctx.fillText(i + '.', 70, 280 + (i*120));
            
            ctx.fillStyle = '#1c1c1e';
            ctx.fillText(task, 110, 280 + (i*120));
            
            ctx.font = '20px sans-serif';
            ctx.fillStyle = '#8e8e93';
            ctx.fillText('æˆªæ­¢æ—¶é—´: ' + time, 110, 320 + (i*120));
            ctx.font = '32px sans-serif';
        }

        // åº•éƒ¨ï¼šç”ŸæˆäºŒç»´ç å¹¶ç»˜åˆ¶
        try {
            const qrUrl = await QRCode.toDataURL(currentUrl, { margin: 1, width: 160 });
            const qrImg = new Image();
            qrImg.src = qrUrl;
            qrImg.onload = () => {
                ctx.drawImage(qrImg, 380, 680, 150, 150);
                ctx.fillStyle = '#8e8e93';
                ctx.font = '16px sans-serif';
                ctx.fillText('æ‰«ç ä½“éªŒæ­¤å·¥å…·', 395, 850);
                
                ctx.font = 'bold 22px sans-serif';
                ctx.fillStyle = '#1c1c1e';
                ctx.fillText('æŠ€æœ¯æ”¯æŒï¼šè‰¾å…œå…œå„¿', 70, 780);
                ctx.font = '18px sans-serif';
                ctx.fillText('AI é©±åŠ¨æ•ˆèƒ½ï¼Œè®©ä¸“æ³¨æ›´ç®€å•', 70, 815);

                // ä¸‹è½½å›¾ç‰‡
                const link = document.createElement('a');
                link.download = `è‰¾å…œå…œå„¿_ä»»åŠ¡æ‰“å¡_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            };
        } catch (err) {
            alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
    }

    // è¾…åŠ©åœ†è§’çŸ©å½¢ç»˜åˆ¶
    function drawRoundedRect(ctx, x, y, width, height, radius) {
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
    }
</script>
</body>
</html>
