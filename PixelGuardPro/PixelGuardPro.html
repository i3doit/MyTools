<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PixelGuard Pro - è‰¾å…œå…œå„¿å®‰å…¨å½±åƒè„±æ•å·¥å…·</title>
    <link rel="stylesheet" href="https://lf3-static.bytecdn.cn/obj/eden-cn/h7nupe_lp_lp/harmonyos_sans.css">
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-accent: #0071e3;
            --glass: rgba(255, 255, 255, 0.85);
            --eye-care: #eef2f3;
        }

        * { box-sizing: border-box; font-family: 'HarmonyOS Sans SC', sans-serif; margin: 0; padding: 0; }

        body {
            background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
            color: #1d1d1f;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            padding: 12px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 0 rgba(0,0,0,0.1);
        }

        .user-info { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 38px; height: 38px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            width: 95%;
            flex: 1;
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* æ¨¡å¼é€‰æ‹©å™¨ */
        .mode-selector {
            display: flex;
            justify-content: center;
            background: rgba(0,0,0,0.05);
            padding: 5px;
            border-radius: 14px;
            gap: 5px;
            width: fit-content;
            margin: 0 auto;
        }

        .mode-btn {
            background: transparent;
            color: #1d1d1f;
            padding: 8px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: 0.2s;
        }

        .mode-btn.active {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            color: var(--apple-accent);
        }

        /* å·¥å…·æ  */
        .toolbar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            background: rgba(255,255,255,0.4);
            padding: 20px;
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .tool-item { display: flex; flex-direction: column; gap: 8px; }
        .tool-item label { font-size: 12px; color: #6e6e73; font-weight: bold; }

        input[type="text"] {
            padding: 10px;
            border: 1px solid #d2d2d7;
            border-radius: 10px;
            background: #fff;
        }

        .action-btns { display: flex; gap: 10px; margin-top: auto; }
        
        button.primary { background: var(--apple-accent); color: white; border: none; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 500;}
        button.secondary { background: #fff; border: 1px solid #d2d2d7; color: #1d1d1f; padding: 10px 20px; border-radius: 12px; cursor: pointer; }

        /* ç”»å¸ƒåŒº */
        #editor-viewport {
            width: 100%;
            height: 65vh;
            background: #e5e5e7;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        #main-canvas {
            position: absolute;
            transform-origin: 0 0;
            cursor: grab;
            image-rendering: auto;
        }

        #main-canvas.mode-mosaic { cursor: crosshair; }
        #main-canvas.mode-watermark { cursor: copy; }

        .upload-area {
            height: 400px;
            border: 2px dashed #c7c7cc;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
        }

        .upload-area:hover { background: rgba(0,113,227,0.03); border-color: var(--apple-accent); }

        #toast {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }

        footer { text-align: center; padding: 30px; font-size: 13px; color: #6e6e73; line-height: 2; }
        footer a { color: var(--apple-accent); text-decoration: none; }

        @media (max-width: 768px) {
            .toolbar { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="toast"></div>

    <header>
        <div class="user-info">
            <img src="https://profile-avatar.csdnimg.cn/22f8b0128b694047beb93057ddc0d7cc_kq8819.jpg!1" class="avatar">
            <strong>PixelGuard Pro</strong>
        </div>
        <div style="font-size: 14px; color: #86868b;">ä½œè€…ï¼šè‰¾å…œå…œå„¿</div>
    </header>

    <div class="container">
        <div class="card">
            <div id="upload-box" class="upload-area" onclick="document.getElementById('file-input').click()">
                <div style="font-size: 50px; margin-bottom: 15px;">ğŸ–¼ï¸</div>
                <h3>å¯¼å…¥éœ€è¦è„±æ•çš„å›¾ç‰‡</h3>
                <p style="color: #86868b; margin-top: 10px;">æ”¯æŒè¶…æ¸…åŸå›¾ï¼Œå…¨åœ°å¤„ç†ï¼Œå®‰å…¨ä¸æ³„éœ²</p>
                <input type="file" id="file-input" hidden accept="image/*">
            </div>

            <div id="editor-ui" style="display: none;">
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="setMode('pan', this)">ğŸ–ï¸ ç§»åŠ¨ç¼©æ”¾</button>
                    <button class="mode-btn" onclick="setMode('mosaic', this)">ğŸ–Œï¸ æ¶‚æŠ¹æ‰“ç </button>
                    <button class="mode-btn" onclick="setMode('watermark', this)">ğŸ’¬ ç‚¹å‡»åŠ æ°´å°</button>
                </div>

                <div class="toolbar">
                    <div class="tool-item">
                        <label>æ‰“ç å¤§å° (å½“å‰æ¨¡å¼æœ‰æ•ˆ)</label>
                        <input type="range" id="brush-size" min="10" max="150" value="50">
                    </div>
                    <div class="tool-item">
                        <label>æ°´å°å†…å®¹</label>
                        <input type="text" id="wm-text" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ°´å°æ–‡å­—" value="ä»…ä¾›å…¥èŒæ ¡éªŒä½¿ç”¨">
                    </div>
                    <div class="tool-item">
                        <label>æ°´å°é¢œè‰²</label>
                        <input type="color" id="wm-color" value="#ffffff">
                    </div>
                    <div class="action-btns">
                        <button class="secondary" onclick="resetView()">å¤ä½</button>
                        <button class="secondary" style="color: #ff3b30;" onclick="clearCanvas()">æ¸…ç©ºé‡æ¥</button>
                        <button class="primary" onclick="downloadImage()">ä¿å­˜é«˜æ¸…åŸå›¾</button>
                    </div>
                </div>

                <div id="editor-viewport">
                    <canvas id="main-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Â© <span id="year-display"></span> è‰¾å…œå…œå„¿ | å®‰å…¨ææ•ˆå·¥å…·ç¾¤ï¼š<a href="javascript:void(0)" onclick="copyText('857023577')">857023577</a></p>
        <div class="links">
            <a href="https://t.zsxq.com/7tSuP" target="_blank">æŠ€æœ¯æ”¯æŒ</a> |
            <a href="https://t.zsxq.com/XNHXs" target="_blank">DeepSeekå®æˆ˜</a> |
            <a href="https://t.zsxq.com/uqG2N" target="_blank">AIç¼–ç¨‹äº§å“</a> |
            <a href="https://mp.weixin.qq.com/s/uHh9gx2sUMOOjIhKyIbx4A" target="_blank">æ›´å¤šå·¥å…·</a>
        </div>
        <div style="opacity: 0.5; margin-top: 10px;">å…¨ç«™è®¿å®¢ç´¯è®¡ï¼š<span id="pv-count">0</span></div>
    </footer>

    <script>
        // åŸºç¡€é…ç½®
        const yearDisplay = document.getElementById('year-display');
        const cy = new Date().getFullYear();
        yearDisplay.innerText = cy > 2026 ? `2026-${cy}` : '2026';

        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const viewport = document.getElementById('editor-viewport');
        const fileInput = document.getElementById('file-input');

        let originalImage = new Image();
        let scale = 1, offsetX = 0, offsetY = 0;
        let isDrawing = false;
        let currentMode = 'pan'; // pan, mosaic, watermark

        // åˆå§‹åŒ–
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                originalImage.src = ev.target.result;
                originalImage.onload = () => {
                    document.getElementById('upload-box').style.display = 'none';
                    document.getElementById('editor-ui').style.display = 'block';
                    canvas.width = originalImage.width;
                    canvas.height = originalImage.height;
                    ctx.drawImage(originalImage, 0, 0);
                    resetView();
                    showToast("å·²è¿›å…¥é«˜æ¸…ç¼–è¾‘æ¨¡å¼");
                };
            };
            reader.readAsDataURL(file);
        };

        function setMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            canvas.className = 'mode-' + mode;
            showToast(`å½“å‰æ¨¡å¼ï¼š${btn.innerText}`);
        }

        // è§†å›¾å˜æ¢
        viewport.onwheel = (e) => {
            e.preventDefault();
            const ratio = e.deltaY > 0 ? 0.9 : 1.1;
            const rect = viewport.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;
            
            offsetX = mx - (mx - offsetX) * ratio;
            offsetY = my - (my - offsetY) * ratio;
            scale *= ratio;
            applyTransform();
        };

        function applyTransform() {
            canvas.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
        }

        function resetView() {
            const r = Math.min(viewport.offsetWidth/canvas.width, viewport.offsetHeight/canvas.height);
            scale = r * 0.9;
            offsetX = (viewport.offsetWidth - canvas.width * scale) / 2;
            offsetY = (viewport.offsetHeight - canvas.height * scale) / 2;
            applyTransform();
        }

        // æ ¸å¿ƒäº¤äº’é€»è¾‘
        viewport.onmousedown = (e) => {
            if (currentMode === 'pan') {
                isDrawing = true;
                viewport.style.cursor = 'grabbing';
            } else if (currentMode === 'mosaic') {
                isDrawing = true;
                doAction(e);
            } else if (currentMode === 'watermark') {
                addWatermarkAt(e);
            }
        };

        window.onmousemove = (e) => {
            if (!isDrawing) return;
            if (currentMode === 'pan') {
                offsetX += e.movementX;
                offsetY += e.movementY;
                applyTransform();
            } else if (currentMode === 'mosaic') {
                doAction(e);
            }
        };

        window.onmouseup = () => {
            isDrawing = false;
            viewport.style.cursor = 'default';
        };

        function getImgCoords(e) {
            const rect = viewport.getBoundingClientRect();
            return {
                x: (e.clientX - rect.left - offsetX) / scale,
                y: (e.clientY - rect.top - offsetY) / scale
            };
        }

        function doAction(e) {
            const pos = getImgCoords(e);
            const bSize = parseInt(document.getElementById('brush-size').value);
            const mSize = bSize / 4; // åƒç´ å—å¯†åº¦

            const startX = pos.x - bSize/2;
            const startY = pos.y - bSize/2;

            try {
                const data = ctx.getImageData(startX, startY, bSize, bSize).data;
                for (let y = 0; y < bSize; y += mSize) {
                    for (let x = 0; x < bSize; x += mSize) {
                        const i = (Math.floor(y) * bSize + Math.floor(x)) * 4;
                        ctx.fillStyle = `rgb(${data[i]},${data[i+1]},${data[i+2]})`;
                        ctx.fillRect(startX + x, startY + y, mSize + 1, mSize + 1);
                    }
                }
            } catch(err) {}
        }

        function addWatermarkAt(e) {
            const pos = getImgCoords(e);
            const text = document.getElementById('wm-text').value;
            if (!text) return showToast("è¯·è¾“å…¥æ°´å°å†…å®¹");

            const fontSize = (canvas.width / 40) / scale; // ä¿æŒè§†è§‰å¤§å°ä¸€è‡´
            ctx.save();
            ctx.font = `${canvas.width/30}px HarmonyOS Sans SC`;
            ctx.fillStyle = document.getElementById('wm-color').value;
            ctx.globalAlpha = 0.6;
            ctx.shadowBlur = 4;
            ctx.shadowColor = "rgba(0,0,0,0.3)";
            ctx.fillText(text, pos.x, pos.y);
            ctx.restore();
            showToast("æ°´å°å·²æ·»åŠ ");
        }

        // åŠŸèƒ½å‡½æ•°
        function downloadImage() {
            const link = document.createElement('a');
            link.download = `è‰¾å…œå…œå„¿_SafeScan_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
            showToast("é«˜æ¸…è„±æ•å›¾ç‰‡å·²ä¿å­˜ï¼");
        }

        function clearCanvas() {
            if (confirm("ç¡®å®šé‡ç½®æ‰€æœ‰ä¿®æ”¹å—ï¼Ÿ")) {
                ctx.drawImage(originalImage, 0, 0);
                showToast("å·²æ¢å¤åŸå›¾");
            }
        }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.innerText = m;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function copyText(t) {
            navigator.clipboard.writeText(t);
            showToast("QQç¾¤å·å·²å¤åˆ¶");
        }

        // æ¨¡æ‹Ÿæµè§ˆé‡
        document.getElementById('pv-count').innerText = Math.floor(Math.random() * 5000 + 1200);
    </script>
</body>
</html>
