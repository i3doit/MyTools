<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026é©¬å¹´å¤§å‰ - ç²’å­è´ºå¡</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: radial-gradient(circle, #8b0000 0%, #000000 100%); font-family: "Microsoft YaHei", sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; }
        
        /* ç•Œé¢ UI */
        .ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 20px; box-sizing: border-box; }
        .ui-overlay * { pointer-events: auto; }

        /* é¡¶éƒ¨éŸ³ä¹ */
        .music-ctrl { position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; background: rgba(255,215,0,0.2); border: 1px solid #ffd700; border-radius: 50%; color: #ffd700; display: flex; align-items: center; justify-content: center; cursor: pointer; animation: rotate 5s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* åº•éƒ¨å¹¿å‘Šä¸çº¢åŒ… */
        .bottom-section { width: 100%; text-align: center; margin-bottom: 30px; }
        .btn-red-packet { background: linear-gradient(145deg, #ff4d4d, #b30000); color: #fff; border: 2px solid #ffd700; padding: 15px 40px; border-radius: 50px; font-size: 1.2rem; font-weight: bold; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); cursor: pointer; margin-bottom: 20px; transition: transform 0.3s; }
        .btn-red-packet:active { transform: scale(0.9); }
        
        .ad-banner { background: rgba(0,0,0,0.5); color: #ffd700; padding: 10px 20px; border-radius: 5px; font-size: 12px; border: 1px dashed #ffd70055; max-width: 80%; margin: 0 auto; }

        /* å¼¹çª—æ ·å¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: #fff; width: 85%; max-width: 400px; padding: 25px; border-radius: 15px; text-align: center; }
        textarea { width: 100%; height: 100px; margin: 15px 0; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .modal-btns { display: flex; justify-content: space-between; gap: 10px; }
        .btn-modal { flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-random { background: #f0ad4e; color: white; }
        .btn-confirm { background: #d9534f; color: white; }
        .btn-share { background: #5bc0de; color: white; margin-top: 10px; width: 100%; }
    </style>
</head>
<body>

<div id="canvas-container"></div>

<div class="ui-overlay">
    <div class="music-ctrl" onclick="toggleMusic()">ğŸµ</div>
    
    <div class="bottom-section">
        <button class="btn-red-packet" onclick="openModal()">ğŸ§§ æ‹†å¼€æˆ‘çš„é©¬å¹´ç¥ç¦</button>
        <div class="ad-banner">
            å¹¿å‘Šå¼•æµåŒºï¼šå…³æ³¨â€œè‰¾å…œå…œå„¿â€è·å–æ›´å¤š2026å®šåˆ¶è´ºå¡
        </div>
    </div>
</div>

<div class="modal" id="wishModal">
    <div class="modal-content">
        <h3>å®šåˆ¶é©¬å¹´ç¥ç¦</h3>
        <textarea id="wishInput" placeholder="è¯·è¾“å…¥ç¥ç¦è¯­..."></textarea>
        <div class="modal-btns">
            <button class="btn-modal btn-random" onclick="setRandomWish()">éšæœºæ–‡æ¡ˆ</button>
            <button class="btn-modal btn-confirm" onclick="applyWish()">ç”Ÿæˆè´ºå¡</button>
        </div>
        <button class="btn-modal btn-share" onclick="shareCard()">ç‚¹å‡»å¤åˆ¶åˆ†äº«é“¾æ¥</button>
        <button class="btn-modal" onclick="closeModal()" style="background:#eee; margin-top:10px; width:100%">å…³é—­</button>
    </div>
</div>

<audio id="bgMusic" loop>
    <source src="https://actions.google.com/animatronic/Happy_Music.mp3" type="audio/mpeg">
</audio>

<script>
    // --- æ•°æ®é…ç½® ---
    const wishes = [
        "é©¬ä¸Šæœ‰ç¦â€”â€”ç¦æ°”éšæ˜¥è‡³ï¼Œå®¶é—¨ä¸‡äº‹å…´",
        "é©¬ä¸Šæœ‰å–œâ€”â€”å–œé¹ŠæŠ¥æ–°å²ï¼Œæ¬¢ç¬‘æ»¡å ‚ç›ˆ",
        "é©¬ä¸Šæœ‰è¿â€”â€”å¥½è¿ä¹˜é£æ¥ï¼Œå‰ç¨‹ä¼¼é”¦æ˜",
        "é©¬ä¸Šæœ‰é’±â€”â€”è´¢æºå¦‚æ½®æ¶Œï¼Œç›†æ»¡é’µæ»¡ç›ˆ",
        "é©¬ä¸Šæœ‰å•â€”â€”è®¢å•çº·çº·è‡³ï¼Œäº‹ä¸šèŠ‚èŠ‚å‡",
        "é©¬ä¸Šæœ‰ç­¾â€”â€”ç­¾çº¦é¡ºåˆ©æˆï¼Œå®å›¾å¤§å±•æ–°",
        "é©¬ä¸Šæœ‰é—²â€”â€”é—²æƒ…ä¼´ç¾æ™¯ï¼Œå¿ƒå®‰å²æœˆå®",
        "é©¬ä¸Šæœ‰ç”œâ€”â€”ç”œèœœå¸¸ç›¸ä¼´ï¼Œæ¸©æƒ…æš–äººå¿ƒ",
        "é©¬ä¸Šæœ‰å…‰â€”â€”å…‰ç…§å‰é€”è·¯ï¼Œé˜´éœ¾å°½æ•£æ¸…",
        "é©¬ä¸Šæœ‰â€œé”‚â€â€”â€”èƒ½æºæ–°æ—¶ä»£ï¼Œåˆ›æ–°æ°¸ä¸åœ",
        "é©¬ä¸Šæœ‰â€œç â€â€”â€”ä»£ç æ— bugï¼Œæ€è·¯æ°¸æ¸…æ–°",
        "é©¬ä¸Šæœ‰ç¦åˆæœ‰é’±ï¼ŒäºŒé›¶äºŒå…­ç¬‘å¼€é¢œ",
        "é©¬ä¸Šæœ‰å•è¿˜æœ‰é—²ï¼Œäº‹ä¸šç”Ÿæ´»ä¸¤å‘¨å…¨"
    ];

    let scene, camera, renderer, particles;
    const particleCount = 5000;
    let currentWish = "è‰¾å…œå…œå„¿ç¥æ‚¨å…ƒæ—¦å¿«ä¹ï¼Œ\né©¬å¹´æœ‰é’±æœ‰é—²æœ‰ç¦æœ‰è¿";

    // --- åˆå§‹åŒ– ---
    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 100;

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // åˆ›å»ºç²’å­
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        for(let i=0; i<particleCount*3; i++) positions[i] = (Math.random() - 0.5) * 200;
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        
        const material = new THREE.PointsMaterial({ color: 0xffd700, size: 0.8, transparent: true, opacity: 0.8 });
        particles = new THREE.Points(geometry, material);
        scene.add(particles);

        // æ£€æµ‹ URL åˆ†äº«å†…å®¹
        const params = new URLSearchParams(window.location.search);
        if(params.get('m')) {
            try { currentWish = decodeURIComponent(atob(params.get('m'))); } catch(e) {}
        }

        morphToText(currentWish);
        animate();
    }

    // --- ç²’å­å˜æ¢æ ¸å¿ƒ (æ–‡å­—è½¬ç²’å­) ---
    function morphToText(text) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 200;
        
        ctx.fillStyle = "white";
        ctx.font = "bold 24px Microsoft YaHei";
        ctx.textAlign = "center";
        
        // å¤„ç†æ¢è¡Œ
        const lines = text.split('\n');
        lines.forEach((line, i) => {
            ctx.fillText(line, 200, 60 + i * 35);
        });

        const imageData = ctx.getImageData(0, 0, 400, 200).data;
        const targetPoints = [];
        
        for (let y = 0; y < 200; y += 3) {
            for (let x = 0; x < 400; x += 3) {
                if (imageData[(y * 400 + x) * 4 + 3] > 128) {
                    targetPoints.push({
                        x: (x - 200) * 0.5,
                        y: (100 - y) * 0.5,
                        z: 0
                    });
                }
            }
        }

        const posAttr = particles.geometry.attributes.position;
        for (let i = 0; i < particleCount; i++) {
            const target = targetPoints[i % targetPoints.length];
            new TWEEN.Tween(posAttr.array)
                .to({
                    [i * 3]: target.x + (Math.random()-0.5)*2,
                    [i * 3 + 1]: target.y + (Math.random()-0.5)*2,
                    [i * 3 + 2]: (Math.random()-0.5)*10
                }, 2000)
                .easing(TWEEN.Easing.Exponential.InOut)
                .start();
        }
        setTimeout(() => posAttr.needsUpdate = true, 0);
    }

    // --- äº¤äº’åŠŸèƒ½ ---
    function openModal() { document.getElementById('wishModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('wishModal').style.display = 'none'; }
    
    function setRandomWish() {
        const random = wishes[Math.floor(Math.random() * wishes.length)];
        document.getElementById('wishInput').value = random;
    }

    function applyWish() {
        const val = document.getElementById('wishInput').value;
        if(val) {
            currentWish = "è‰¾å…œå…œå„¿ç¥æ‚¨ï¼š\n" + val;
            morphToText(currentWish);
            closeModal();
        }
    }

    function shareCard() {
        const val = document.getElementById('wishInput').value || currentWish;
        const encoded = btoa(encodeURIComponent(val));
        const url = window.location.origin + window.location.pathname + "?m=" + encoded;
        
        navigator.clipboard.writeText(url).then(() => {
            alert("åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼å‘ç»™å¾®ä¿¡å¥½å‹è¯•è¯•å§ã€‚");
        });
    }

    function toggleMusic() {
        const audio = document.getElementById('bgMusic');
        audio.paused ? audio.play() : audio.pause();
    }

    function animate() {
        requestAnimationFrame(animate);
        TWEEN.update();
        particles.geometry.attributes.position.needsUpdate = true;
        particles.rotation.y += 0.002;
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init();
</script>
</body>
</html>
