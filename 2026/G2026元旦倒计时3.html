<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026å…ƒæ—¦å€’è®¡æ—¶ç¥ç¦</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --apple-bg: #000000;
            --apple-card: rgba(28, 28, 30, 0.8);
            --accent-gold: #d4af37;
            --accent-red: #ff3b30;
            --text-main: #f5f5f7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, "SF Pro Display", "PingFang SC", sans-serif;
            background: var(--apple-bg);
            color: var(--text-main);
            overflow-x: hidden;
        }

        /* åŠ¨æ€æ˜Ÿç©ºèƒŒæ™¯ */
        #starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; }
        .meteor {
            position: absolute; width: 2px; height: 2px; background: #fff;
            border-radius: 50%; opacity: 0; animation: meteor-ani 3s linear infinite;
        }
        @keyframes meteor-ani {
            0% { transform: rotate(35deg) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: rotate(35deg) translateX(-800px); opacity: 0; }
        }

        .container { max-width: 500px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* é¡µé¢åˆ‡æ¢é€»è¾‘ */
        .view-section { display: none; width: 100%; animation: fadeIn 0.5s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ç£¨ç ‚ç»ç’ƒå¡ç‰‡ */
        .glass-card {
            background: var(--apple-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
        }

        /* å€’è®¡æ—¶ */
        .timer-display { display: flex; justify-content: space-around; margin: 30px 0; }
        .timer-unit { text-align: center; }
        .timer-unit b { font-size: 2rem; display: block; color: var(--accent-gold); }
        .timer-unit span { font-size: 0.7rem; color: #888; }

        /* ç¼–è¾‘è¡¨å• */
        .edit-group { margin-bottom: 15px; }
        .edit-group label { display: block; font-size: 13px; color: #888; margin-bottom: 8px; }
        input, textarea {
            width: 100%; background: rgba(255,255,255,0.1); border: 1px solid transparent;
            border-radius: 10px; color: #fff; padding: 12px; font-size: 15px; outline: none;
        }
        input:focus { border-color: var(--accent-gold); }

        /* é¢„è§ˆ/è®¿å®¢å¡ç‰‡åŒºåŸŸ (ç”¨äºå›¾ç‰‡ç”Ÿæˆ) */
        #share-card-area {
            background: linear-gradient(135deg, #1c1c1e 0%, #000 100%);
            padding: 25px; border-radius: 20px; border: 1px solid #333;
        }
        .card-user { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .card-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent-gold); }
        .card-nick { font-size: 18px; font-weight: 60 b; margin: 0; }
        .card-invite { font-size: 12px; color: #888; margin: 4px 0 0; }
        .card-msg { font-size: 16px; line-height: 1.6; color: #eee; min-height: 50px; white-space: pre-wrap; word-wrap: break-word; }
        
        .qr-wrapper { text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px dashed #444; }
        #qrcode-img { background: #fff; padding: 10px; border-radius: 8px; display: inline-block; }
        .qr-tip { font-size: 10px; color: #666; margin-top: 8px; }

        /* åº•éƒ¨æ“ä½œ */
        .btn {
            width: 100%; padding: 15px; border-radius: 12px; border: none; font-size: 16px; font-weight: 600;
            cursor: pointer; margin-bottom: 12px; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-gold { background: var(--accent-gold); color: #000; }
        .btn-outline { background: transparent; border: 1px solid #444; color: #fff; }
        .btn:active { transform: scale(0.98); }

        .footer { text-align: center; font-size: 12px; color: #444; margin-top: auto; padding: 20px 0; }
        .footer a { color: #666; text-decoration: none; margin: 0 5px; }
    </style>
</head>
<body>

<canvas id="starfield"></canvas>

<div class="container">
    <div id="section-countdown" class="view-section">
        <h2 style="text-align:center; font-weight:300; letter-spacing:3px;">2026</h2>
        <h1 style="text-align:center; margin-top:0;">ä¸™åˆé©¬å¹´ å€’è®¡æ—¶</h1>
        <div class="timer-display">
            <div class="timer-unit"><b id="d">00</b><span>å¤©</span></div>
            <div class="timer-unit"><b id="h">00</b><span>æ—¶</span></div>
            <div class="timer-unit"><b id="m">00</b><span>åˆ†</span></div>
            <div class="timer-unit"><b id="s">00</b><span>ç§’</span></div>
        </div>
        <button class="btn btn-gold" onclick="enterEditMode()">åˆ¶ä½œæˆ‘çš„ç¥ç¦å¡ç‰‡</button>
    </div>

    <div id="section-editor" class="view-section">
        <div class="glass-card">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
                <input type="file" id="file-input" hidden accept="image/*" onchange="loadAvatar(this)">
                <img id="edit-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" style="width:60px; height:60px; border-radius:50%; cursor:pointer; border:2px solid var(--accent-gold)" onclick="document.getElementById('file-input').click()">
                <div style="flex:1">
                    <label>æˆ‘çš„æ˜µç§°</label>
                    <input type="text" id="input-nick" value="è‰¾å…œå…œå„¿" onclick="this.value=''" oninput="updatePreview()">
                </div>
            </div>
            <div class="edit-group">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                    <label>é©¬å¹´ç¥ç¦è¯­</label>
                    <span style="font-size:12px; color:var(--accent-gold); cursor:pointer;" onclick="randomWish()">ğŸ”„ éšæœºç¥ç¦</span>
                </div>
                <textarea id="input-msg" rows="3" maxlength="300" oninput="updatePreview()">æ„¿ä½ åœ¨2026é©¬å¹´ï¼šé¾™é©¬ç²¾ç¥ï¼Œäº‹ä¸šä¸€é©¬å½“å…ˆï¼Œç”Ÿæ´»ä¸‡é©¬å¥”è…¾ï¼ğŸ</textarea>
            </div>
        </div>
        
        <p style="font-size:13px; color:#888; margin-left:10px;">å¡ç‰‡é¢„è§ˆï¼š</p>
        <div id="share-card-area">
            <div class="card-user">
                <img id="pre-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="card-avatar">
                <div>
                    <p class="card-nick" id="pre-nick">è‰¾å…œå…œå„¿</p>
                    <p class="card-invite">é‚€è¯·ä½ å¼€å¯ 2026 é¸¿è¿ ğŸ‰</p>
                </div>
            </div>
            <div class="card-msg" id="pre-msg"></div>
            <div class="qr-wrapper">
                <div id="qrcode-img"></div>
                <p class="qr-tip">æ‰«æäºŒç»´ç  Â· æŸ¥çœ‹é©¬å¹´ç¥ç¦</p>
            </div>
        </div>

        <div style="margin-top:20px;">
            <button class="btn btn-gold" onclick="copyShareLink()">ğŸ”— å¤åˆ¶åˆ†äº«é“¾æ¥</button>
            <button class="btn btn-outline" onclick="saveAsImage()">ğŸ“¸ ä¸‹è½½ç¥ç¦å›¾ç‰‡</button>
        </div>
    </div>

    <div id="section-visitor" class="view-section">
        <div id="visitor-card-render">
            </div>
        <button class="btn btn-gold" style="margin-top:20px" onclick="location.href=window.location.origin + window.location.pathname">åˆ¶ä½œåŒæ¬¾ç¥ç¦</button>
    </div>

    <div class="footer">
        <a href="https://mp.weixin.qq.com/s/iLF370sg-N87Ubsma_iaxw">è‰¾å…œå…œå„¿</a> | 
        <a href="javascript:void(0)" onclick="copyWX()">è”ç³»ä½œè€…</a>
    </div>
</div>

<script>
    const TARGET_DATE = new Date("2026-01-01T00:00:00").getTime();
    const WISH_BANK = [
        "ğŸ 2026é©¬å¹´åˆ°ï¼Œç¥ä½ é¾™é©¬ç²¾ç¥ï¼Œå¿«é©¬åŠ é­ï¼Œå¥”å‘é”¦ç»£å‰ç¨‹ï¼",
        "é©¬è¹„å£°å£°æŠ¥å–œæ¥ï¼Œæ„¿ä½ åœ¨æ–°çš„ä¸€å¹´é‡Œï¼Œé©¬åˆ°æˆåŠŸï¼Œä¸‡äº‹å¤§å‰ï¼",
        "è¾æ—§è¿æ–°èµ´é©¬å¹´ï¼Œç¥ä½ ä¸€é©¬å½“å…ˆï¼ŒäºŒé©¬å¥”è…¾ï¼Œä¸‰é©¬å¼€æ³°ï¼Œå››å­£å¹³å®‰ï¼",
        "æ„¿2026é©¬å¹´ï¼Œä½ çš„å¥½è¿å¦‚éªé©¬å¥”è…¾ï¼ŒåŠ¿ä¸å¯æŒ¡ï¼ğŸâœ¨",
        "é©¬å¹´ç¥ä½ ï¼šäº‹ä¸šä¸€é©¬å¹³å·ï¼Œç”Ÿæ´»é²œè¡£æ€’é©¬ï¼Œæœªæ¥å¤©é©¬è¡Œç©ºï¼",
        "2026ï¼Œæ„¿ä½ ç­–é©¬æ‰¬é­è‡ªå¥‹è¹„ï¼Œä¸è´ŸéŸ¶åæ›´è¿›å–ã€‚å…ƒæ—¦å¿«ä¹ï¼"
    ];

    // åˆå§‹åŒ–æµæ˜Ÿ
    function initStars() {
        const field = document.getElementById('starfield');
        for (let i = 0; i < 12; i++) {
            let m = document.createElement('div');
            m.className = 'meteor';
            m.style.left = Math.random() * 100 + '%';
            m.style.top = Math.random() * 40 + '%';
            m.style.animationDelay = (Math.random() * 5) + 's';
            document.body.appendChild(m);
        }
    }

    // æ ¸å¿ƒé€»è¾‘åˆ¤æ–­
    function checkRouter() {
        const params = new URLSearchParams(window.location.search);
        const nick = params.get('n');
        const msg = params.get('m');
        const avatar = params.get('a'); // é¢„ç•™å¤´åƒå‚æ•°
        const isEdit = params.get('mode') === 'edit';
        const now = new Date().getTime();

        // å¦‚æœæ˜¯è®¿å®¢å¸¦å‚æ•°è¿›æ¥
        if (nick || msg) {
            if (now < TARGET_DATE) {
                showView('section-countdown');
                startCountdown();
            } else {
                renderVisitorCard(nick, msg);
                showView('section-visitor');
            }
        } else {
            // é»˜è®¤æ˜¾ç¤ºå€’è®¡æ—¶ï¼Œé™¤éæ˜ç¡®è¿›å…¥ç¼–è¾‘
            if (isEdit) {
                showView('section-editor');
                updatePreview();
            } else {
                showView('section-countdown');
                startCountdown();
            }
        }
    }

    function showView(id) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function enterEditMode() {
        const url = new URL(window.location.href);
        url.searchParams.set('mode', 'edit');
        window.history.pushState({}, '', url);
        showView('section-editor');
        updatePreview();
    }

    // å€’è®¡æ—¶
    function startCountdown() {
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const diff = TARGET_DATE - now;
            if (diff <= 0) { clearInterval(timer); location.reload(); return; }
            document.getElementById('d').innerText = Math.floor(diff / 86400000).toString().padStart(2, '0');
            document.getElementById('h').innerText = Math.floor((diff % 86400000) / 3600000).toString().padStart(2, '0');
            document.getElementById('m').innerText = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
            document.getElementById('s').innerText = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
        }, 1000);
    }

    // ç¼–è¾‘å™¨åŠŸèƒ½
    function loadAvatar(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('edit-avatar').src = e.target.result;
                document.getElementById('pre-avatar').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function randomWish() {
        document.getElementById('input-msg').value = WISH_BANK[Math.floor(Math.random() * WISH_BANK.length)];
        updatePreview();
    }

    let qrcodeObj = null;
    function updatePreview() {
        const nick = document.getElementById('input-nick').value || "è‰¾å…œå…œå„¿";
        const msg = document.getElementById('input-msg').value || "å…ƒæ—¦å¿«ä¹";
        document.getElementById('pre-nick').innerText = nick;
        document.getElementById('pre-msg').innerText = msg;

        // ç”Ÿæˆå¸¦å‚æ•°çš„å®Œæ•´URL
        const currentUrl = window.location.origin + window.location.pathname;
        const shareUrl = `${currentUrl}?n=${encodeURIComponent(nick)}&m=${encodeURIComponent(msg)}`;

        const qrContainer = document.getElementById('qrcode-img');
        qrContainer.innerHTML = '';
        qrcodeObj = new QRCode(qrContainer, {
            text: shareUrl,
            width: 120,
            height: 120,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
    }

    // è®¿å®¢å¡ç‰‡æ¸²æŸ“
    function renderVisitorCard(n, m) {
        const container = document.getElementById('visitor-card-render');
        const nick = decodeURIComponent(n || "å¥½å‹");
        const msg = decodeURIComponent(m || "ç¥ä½ å…ƒæ—¦å¿«ä¹ï¼");
        
        container.innerHTML = `
            <div id="share-card-area">
                <div class="card-user">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="card-avatar">
                    <div>
                        <p class="card-nick">${nick}</p>
                        <p class="card-invite">é€æ¥ä¸€ä»½ 2026 é¸¿è¿ç¥ç¦ ğŸ‰</p>
                    </div>
                </div>
                <div class="card-msg">${msg}</div>
                <div style="margin-top:30px; border-top:1px solid #333; padding-top:20px; text-align:center">
                    <p style="color:var(--accent-gold); font-size:14px; font-weight:bold">Happy New Year 2026</p>
                    <p style="font-size:11px; color:#555">2026 Â· ä¸™åˆé©¬å¹´ Â· å²åºæ›´æ–°</p>
                </div>
            </div>
        `;
    }

    // åŠŸèƒ½æ“ä½œ
    async function copyShareLink() {
        const nick = document.getElementById('input-nick').value || "å¥½å‹";
        const msg = document.getElementById('input-msg').value || "";
        const shareUrl = `${window.location.origin + window.location.pathname}?n=${encodeURIComponent(nick)}&m=${encodeURIComponent(msg)}`;
        
        const finalContent = `è¿™æ˜¯æ¥è‡ªã€${nick}ã€‘çš„2026é©¬å¹´ç¥ç¦ï¼š\n"${msg}"\nç‚¹å‡»å¼€å¯ç¥ç¦ï¼š${shareUrl}`;
        
        try {
            await navigator.clipboard.writeText(finalContent);
            alert("é“¾æ¥å·²å¤åˆ¶ï¼Œå¿«å‘ç»™å¥½å‹æˆ–æœ‹å‹åœˆå§ï¼");
        } catch (err) {
            const input = document.createElement('textarea');
            input.value = finalContent; document.body.appendChild(input);
            input.select(); document.execCommand('copy');
            document.body.removeChild(input);
            alert("å¤åˆ¶æˆåŠŸï¼");
        }
    }

    function saveAsImage() {
        const area = document.getElementById('share-card-area');
        html2canvas(area, {
            useCORS: true,
            backgroundColor: "#000",
            scale: 2
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `2026ç¥ç¦å¡ç‰‡-${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }

    function copyWX() {
        const wx = "857023577";
        navigator.clipboard.writeText(wx).then(() => {
            alert("ä½œè€…å¾®ä¿¡å·å·²å¤åˆ¶: " + wx);
        });
    }

    window.onload = () => {
        initStars();
        checkRouter();
    };
</script>

</body>
</html>
