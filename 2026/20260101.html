<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026å…ƒæ—¦å¿«ä¹ - çµé©¬è´ºå²</title>
    <style>
        :root {
            --gold: #ffdf00;
            --red: #ff2e2e;
        }
        body, html { margin: 0; padding: 0; overflow: hidden; background: #050505; font-family: "Microsoft YaHei", sans-serif; }
        #canvas { display: block; }
        
        /* UI å±‚ */
        .ui-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .interactive { pointer-events: auto; }

        /* åº•éƒ¨å¹¿å‘Šä¸æ“ä½œåŒº */
        .bottom-bar { position: absolute; bottom: 30px; width: 100%; text-align: center; }
        .btn-lucky { background: linear-gradient(45deg, var(--red), #ff6b6b); color: white; border: none; padding: 12px 30px; border-radius: 50px; font-size: 18px; cursor: pointer; box-shadow: 0 0 20px rgba(255,46,46,0.5); animation: pulse 2s infinite; }
        
        /* å¼¹çª—æ ·å¼ */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.95); border: 1px solid var(--gold); padding: 25px; border-radius: 15px; z-index: 100; width: 85%; max-width: 400px; color: white; }
        textarea { width: 100%; height: 100px; background: #333; border: 1px solid #555; color: white; margin: 15px 0; border-radius: 8px; padding: 10px; box-sizing: border-box; }
        .modal-btns { display: flex; justify-content: space-between; }
        .modal-btns button { padding: 8px 15px; border-radius: 5px; cursor: pointer; border: none; }
        .btn-cancel { background: #555; color: white; }
        .btn-confirm { background: var(--gold); color: black; }

        /* éŸ³ä¹æŒ‰é’® */
        .music-btn { position: fixed; top: 20px; right: 20px; width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; border: 1px solid white; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="ui-overlay">
    <div class="music-btn interactive" onclick="toggleMusic()">ğŸµ</div>
    
    <div class="bottom-bar">
        <button class="btn-lucky interactive" onclick="openModal()">ğŸ§§ æ‹†çº¢åŒ… Â· å®šåˆ¶ç¥ç¦</button>
        <p style="color: rgba(255,223,0,0.6); font-size: 12px; margin-top: 15px;">å¹¿å‘Šä½ï¼šå…³æ³¨è‰¾å…œå…œå„¿ï¼Œè§£é”æ›´å¤š2026æ–°å¹´æƒŠå–œ</p>
    </div>
</div>

<div id="modal" class="modal interactive">
    <h3>å†™ä¸‹ä½ çš„2026æ–°å¹´æ„¿æœ›</h3>
    <textarea id="blessInput" placeholder="è¯·è¾“å…¥ä½ çš„ç¥ç¦è¯­..."></textarea>
    <div class="modal-btns">
        <button class="btn-cancel" onclick="randomBless()">ğŸ² æ¢ä¸€ä¸ª</button>
        <button class="btn-confirm" onclick="applyBlessing()">ğŸš€ ç”Ÿæˆæˆ‘çš„è´ºå¡</button>
    </div>
</div>

<script>
    /**
     * è¯¥è„šæœ¬å®ç°äº†ç²’å­ç³»ç»Ÿçš„åŸºç¡€æ¡†æ¶
     * åŒ…å«é©¬å½¢æ€ç‚¹é˜µæ¨¡æ‹Ÿã€æ–‡å­—è½¬æ¢é€»è¾‘
     */
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const blessInput = document.getElementById('blessInput');
    const modal = document.getElementById('modal');

    let width, height, particles = [];
    let currentText = "è‰¾å…œå…œå„¿ç¥æ‚¨å…ƒæ—¦å¿«ä¹\né©¬å¹´æœ‰é’±æœ‰é—²æœ‰ç¦æœ‰è¿";

    const presetBlessings = [
        "é©¬ä¸Šæœ‰ç¦â€”â€”ç¦æ°”éšæ˜¥è‡³ï¼Œå®¶é—¨ä¸‡äº‹å…´",
        "é©¬ä¸Šæœ‰å–œâ€”â€”å–œé¹ŠæŠ¥æ–°å²ï¼Œæ¬¢ç¬‘æ»¡å ‚ç›ˆ",
        "é©¬ä¸Šæœ‰é’±â€”â€”è´¢æºå¦‚æ½®æ¶Œï¼Œç›†æ»¡é’µæ»¡ç›ˆ",
        "é©¬ä¸Šæœ‰é—²â€”â€”é—²æƒ…ä¼´ç¾æ™¯ï¼Œå¿ƒå®‰å²æœˆå®",
        "é©¬ä¸Šæœ‰â€œé”‚â€â€”â€”èƒ½æºæ–°æ—¶ä»£ï¼Œåˆ›æ–°æ°¸ä¸åœ",
        "é©¬ä¸Šæœ‰ç¦åˆæœ‰é’±ï¼ŒäºŒé›¶äºŒå…­ç¬‘å¼€é¢œ"
    ];

    // åˆå§‹åŒ–å‚æ•°
    function init() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        // è§£æ URL å‚æ•°å®ç°åˆ†äº«åŠŸèƒ½
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('m')) {
            currentText = decodeURIComponent(atob(urlParams.get('m')));
        }
        createParticlesFromText(currentText);
    }

    // ç²’å­ç±»
    class Particle {
        constructor(x, y) {
            this.x = Math.random() * width;
            this.y = Math.random() * height;
            this.destX = x;
            this.destY = y;
            this.color = `hsl(${Math.random() * 50 + 10}, 100%, 60%)`;
            this.friction = 0.95;
            this.vx = 0; this.vy = 0;
            this.radius = Math.random() * 1.5 + 1;
        }
        update() {
            let dx = this.destX - this.x;
            let dy = this.destY - this.y;
            this.vx += dx * 0.01;
            this.vy += dy * 0.01;
            this.vx *= this.friction;
            this.vy *= this.friction;
            this.x += this.vx;
            this.y += this.vy;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    // æ ¹æ®æ–‡å­—ç”Ÿæˆç²’å­åæ ‡
    function createParticlesFromText(text) {
        particles = [];
        ctx.clearRect(0,0,width,height);
        ctx.fillStyle = "white";
        ctx.font = "bold 30px Microsoft YaHei";
        
        const lines = text.split('\n');
        lines.forEach((line, i) => {
            ctx.fillText(line, width/2 - ctx.measureText(line).width/2, height/2 - (lines.length*20) + (i*50));
        });

        const imageData = ctx.getImageData(0,0,width,height).data;
        for (let y = 0; y < height; y += 4) {
            for (let x = 0; x < width; x += 4) {
                if (imageData[(y * width + x) * 4 + 3] > 128) {
                    particles.push(new Particle(x, y));
                }
            }
        }
    }

    function animate() {
        ctx.fillStyle = 'rgba(5, 5, 5, 0.2)';
        ctx.fillRect(0, 0, width, height);
        particles.forEach(p => {
            p.update();
            p.draw();
        });
        requestAnimationFrame(animate);
    }

    // äº¤äº’é€»è¾‘
    function openModal() { modal.style.display = 'block'; }
    
    function randomBless() {
        const rand = presetBlessings[Math.floor(Math.random() * presetBlessings.length)];
        blessInput.value = rand;
    }

    function applyBlessing() {
        const text = blessInput.value || "2026 å¤§å‰";
        currentText = text;
        createParticlesFromText(text);
        modal.style.display = 'none';
        
        // æ›´æ–° URL å®ç°â€œä¼ªåˆ†äº«â€
        const newUrl = window.location.origin + window.location.pathname + "?m=" + btoa(encodeURIComponent(text));
        console.log("åˆ†äº«é“¾æ¥å·²ç”Ÿæˆ: ", newUrl);
        alert("è´ºå¡ç”ŸæˆæˆåŠŸï¼å¤åˆ¶æµè§ˆå™¨åœ°å€å³å¯åˆ†äº«ç»™å¥½å‹ã€‚");
    }

    function toggleMusic() {
        alert("èƒŒæ™¯éŸ³ä¹åˆ‡æ¢ï¼š[1.æ˜¥èŠ‚åºæ›² 2.æ­¥æ­¥é«˜ 3.å¥½è¿æ¥]");
    }

    window.addEventListener('resize', init);
    init();
    animate();
</script>
</body>
</html>
