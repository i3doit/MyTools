<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ™ºèƒ½ä»£ç è¿è¡Œå™¨ Pro - è‰¾å…œå…œå„¿</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4CAF50;
            --accent: #007acc;
            --warning: #ff9800;
            --bg: #1a1a1a;
            --panel: #252526;
            --text: #ccc;
            --border: #333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; background: #000; font-family: -apple-system, sans-serif; }

        /* æ•´ä½“å¸ƒå±€ï¼šç¡®ä¿åº•éƒ¨å›ºå®š */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--bg);
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            height: 50px; background: var(--panel); border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; padding: 0 12px; flex-shrink: 0;
        }
        .logo { color: white; font-size: 14px; font-weight: bold; }
        .logo span { color: var(--primary); font-size: 10px; margin-left: 4px; border: 1px solid; padding: 0 2px; }

        .nav-icons { display: flex; gap: 12px; }
        .icon-btn {
            background: none; border: none; cursor: pointer; color: var(--text);
            display: flex; flex-direction: column; align-items: center;
        }
        .icon-btn i { font-style: normal; font-size: 18px; }
        .icon-btn label { font-size: 9px; margin-top: 2px; cursor: pointer; }

        /* ä¸­é—´ä¸»ä½“ */
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        /* ç«–å±æ¯”ä¾‹è°ƒæ•´ï¼šä»£ç  30% | é¢„è§ˆ 70% */
        .editor-box { height: 30%; display: flex; border-bottom: 1px solid var(--border); position: relative; }
        .preview-box { height: 70%; background: #fff; }
        
        .line-num { width: 30px; padding: 5px 0; color: #555; font-size: 10px; text-align: center; background: rgba(0,0,0,0.1); }
        textarea { flex: 1; background: transparent; color: var(--text); border: none; padding: 8px; resize: none; outline: none; font-size: 13px; font-family: monospace; }
        iframe { width: 100%; height: 100%; border: none; }

        /* åº•éƒ¨ä¿¡æ¯ï¼šé”å®šåœ¨æœ€ä¸‹æ–¹ï¼Œæ°¸ä¸æ¶ˆå¤± */
        footer {
            background: var(--panel); border-top: 1px solid var(--border);
            padding: 8px 12px calc(8px + env(safe-area-inset-bottom));
            flex-shrink: 0; z-index: 10;
        }
        .ad-wrap { 
            background: linear-gradient(90deg, transparent, rgba(255,152,0,0.15), transparent);
            padding: 6px; border-radius: 4px; text-align: center; margin-bottom: 4px;
        }
        .ad-wrap a { color: var(--warning); text-decoration: none; font-size: 12px; font-weight: bold; }
        .footer-info { display: flex; justify-content: center; gap: 15px; font-size: 11px; color: var(--text); opacity: 0.8; }
        .wx-link { color: var(--accent); font-weight: bold; text-decoration: underline; cursor: pointer; }

        /* åˆ†äº«å¼¹çª—ï¼ˆåç‰‡å¼ï¼‰ */
        #shareModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;
        }
        .card-capture-area {
            background: white; padding: 25px; border-radius: 15px; width: 300px; text-align: center;
        }
        .card-capture-area h3 { color: #333; font-size: 20px; margin-bottom: 5px; }
        .card-capture-area p { color: #666; font-size: 13px; }
        .qr-placeholder { width: 200px; height: 200px; margin: 15px auto; border: 1px solid #eee; display: block; }
        
        .modal-btns { margin-top: 15px; display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .save-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .close-btn { color: #999; font-size: 12px; background: none; border: none; cursor: pointer; }

        #toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 12px; z-index: 2000; display: none; }

        /* æ¨ªå±é€‚é… */
        @media (min-width: 768px) {
            main { flex-direction: row; }
            .editor-box { height: 100%; width: 40%; border-bottom: none; border-right: 1px solid var(--border); }
            .preview-box { height: 100%; width: 60%; }
        }
    </style>
</head>
<body class="theme-dark">

<div class="app-container">
    <header>
        <div class="logo">RUNNER <span>PRO</span></div>
        <div class="nav-icons">
            <button class="icon-btn" onclick="doPaste()"><i>ğŸ“‹</i><label id="l-paste">ç²˜è´´</label></button>
            <button class="icon-btn" onclick="openShare()"><i>ğŸ“¤</i><label id="l-share">åˆ†äº«</label></button>
            <button class="icon-btn" onclick="toggleLang()"><i>ğŸŒ</i><label id="l-curr">ä¸­æ–‡</label></button>
            <button class="icon-btn" onclick="clearCode()"><i>ğŸ—‘ï¸</i><label id="l-clear">æ¸…ç©º</label></button>
            <button class="icon-btn" style="color:var(--primary)" onclick="runCode()"><i>â–¶</i><label id="l-run">è¿è¡Œ</label></button>
        </div>
    </header>

    <main>
        <div class="editor-box">
            <div class="line-num" id="ln-box">1</div>
            <textarea id="editor" spellcheck="false"></textarea>
        </div>
        <div class="preview-box">
            <iframe id="preview"></iframe>
        </div>
    </main>

    <footer>
        <div class="ad-wrap">
            <a href="#" id="ad-text">ğŸ è‰¾å…œå…œå„¿ä¸“å±ï¼šé«˜æ€§èƒ½æœåŠ¡å™¨ç‰¹æƒ å…¥å£ ></a>
        </div>
        <div class="footer-info">
            <span><b id="l-author">ä½œè€…</b>: è‰¾å…œå…œå„¿</span>
            <span>WeChat: <b class="wx-link" onclick="copyWx()">857023577</b></span>
        </div>
    </footer>
</div>

<div id="shareModal">
    <div style="display: flex; flex-direction: column; align-items: center;">
        <div id="cardArea" class="card-capture-area">
            <h3 id="s-title">æ™ºèƒ½ä»£ç è¿è¡Œå™¨</h3>
            <p id="s-author">ä½œè€…: è‰¾å…œå…œå„¿ | å¾®ä¿¡: 857023577</p>
            <img id="qrImg" class="qr-placeholder" src="" alt="äºŒç»´ç ">
            <p style="font-size: 11px; color: #aaa;">æ‰«æäºŒç»´ç ï¼Œå¼€å¯æ™ºèƒ½é¢„è§ˆ</p>
        </div>
        
        <div class="modal-btns">
            <button class="save-btn" onclick="saveToAlbum()" id="l-dl">ä¿å­˜å®Œæ•´åç‰‡åˆ°ç›¸å†Œ</button>
            <button class="close-btn" onclick="closeModal()">è¿”å›ç¼–è¾‘</button>
        </div>
    </div>
</div>

<div id="toast"></div>

<script>
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');
    const toast = document.getElementById('toast');
    
    // å¤šè¯­è¨€å†…å®¹å­—å…¸ï¼ˆåŒ…å«ä»£ç ç¤ºä¾‹çš„ç¿»è¯‘ï¼‰
    const i18n = {
        'zh': {
            paste:'ç²˜è´´', share:'åˆ†äº«', clear:'æ¸…ç©º', run:'è¿è¡Œ', author:'ä½œè€…', dl:'ä¿å­˜åç‰‡å›¾ç‰‡', curr:'ä¸­æ–‡',
            ad:'ğŸ è‰¾å…œå…œå„¿ä¸“å±ï¼šé«˜æ€§èƒ½æœåŠ¡å™¨ç‰¹æƒ å…¥å£ >', title:'æ™ºèƒ½ä»£ç è¿è¡Œå™¨',
            code: `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{font-family:sans-serif;text-align:center;padding:20px;}h2{color:#4CAF50;}.card{border:1px solid #eee;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.05);}</style></head><body><div class="card"><h2>ğŸš€ è¿è¡Œå™¨å·²å°±ç»ª</h2><p>ä½œè€…ï¼šè‰¾å…œå…œå„¿</p><p>ç‚¹å‡»â€œåˆ†äº«â€å¯ä¿å­˜ä¸“å±åç‰‡</p></div></body></html>`
        },
        'en': {
            paste:'Paste', share:'Share', clear:'Clear', run:'Run', author:'Author', dl:'Save Card Image', curr:'English',
            ad:'ğŸ Exclusive: Best Cloud Server Deals >', title:'Smart Code Runner',
            code: `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{font-family:sans-serif;text-align:center;padding:20px;}h2{color:#4CAF50;}.card{border:1px solid #eee;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.05);}</style></head><body><div class="card"><h2>ğŸš€ Runner Ready</h2><p>Author: AiDouDou</p><p>Click "Share" to save your card</p></div></body></html>`
        }
    };

    let curLang = 'zh';

    function init() {
        const savedCode = localStorage.getItem('dd_v5_code');
        curLang = localStorage.getItem('dd_v5_lang') || 'zh';
        editor.value = savedCode || i18n[curLang].code;
        updateUI();
        runCode();
        updateLines();
    }

    function toggleLang() {
        curLang = curLang === 'zh' ? 'en' : 'zh';
        localStorage.setItem('dd_v5_lang', curLang);
        editor.value = i18n[curLang].code; // åˆ‡æ¢è¯­è¨€æ—¶ï¼Œç¤ºä¾‹å†…å®¹åŒæ­¥ç¿»è¯‘
        updateUI();
        runCode();
        updateLines();
        showToast(curLang === 'zh' ? "å·²åˆ‡æ¢è‡³ä¸­æ–‡" : "Switched to English");
    }

    function updateUI() {
        const d = i18n[curLang];
        document.getElementById('l-paste').innerText = d.paste;
        document.getElementById('l-share').innerText = d.share;
        document.getElementById('l-clear').innerText = d.clear;
        document.getElementById('l-run').innerText = d.run;
        document.getElementById('l-author').innerText = d.author;
        document.getElementById('l-curr').innerText = d.curr;
        document.getElementById('l-dl').innerText = d.dl;
        document.getElementById('ad-text').innerText = d.ad;
        document.getElementById('s-title').innerText = d.title;
    }

    function runCode() {
        const doc = preview.contentDocument || preview.contentWindow.document;
        doc.open();
        doc.write('<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">');
        doc.write(editor.value);
        doc.close();
    }

    // åç‰‡åˆ†äº«ä¸ä¿å­˜
    function openShare() {
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(window.location.href)}`;
        document.getElementById('qrImg').src = qrUrl;
        document.getElementById('shareModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('shareModal').style.display = 'none';
    }

    // çœŸæ­£çš„å›¾ç‰‡ä¸‹è½½åŠŸèƒ½ï¼šå°† HTML è½¬åŒ–ä¸º Canvas å¹¶ä¸‹è½½
    function saveToAlbum() {
        showToast("æ­£åœ¨ç”Ÿæˆé«˜æ¸…åç‰‡...");
        const card = document.getElementById('cardArea');
        html2canvas(card, { useCORS: true, scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'AiDouDou-Runner-Card.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
            showToast("å›¾ç‰‡å·²å°è¯•ä¸‹è½½");
        });
    }

    async function doPaste() {
        try {
            const text = await navigator.clipboard.readText();
            if(text) { editor.value = text; updateLines(); runCode(); showToast("å·²ç²˜è´´å†…å®¹"); }
        } catch(e) { showToast("è¯·æ‰‹åŠ¨ç²˜è´´"); }
    }

    function clearCode() {
        editor.value = ''; updateLines(); runCode(); showToast("å·²æ¸…ç©º");
    }

    function copyWx() {
        navigator.clipboard.writeText('857023577').then(() => showToast("å¾®ä¿¡å·å·²å¤åˆ¶"));
    }

    function showToast(m) {
        toast.innerText = m; toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 1500);
    }

    function updateLines() {
        const count = editor.value.split('\n').length;
        let h = ''; for(let i=1; i<=count; i++) h += i + '<br>';
        document.getElementById('ln-box').innerHTML = h;
    }

    editor.addEventListener('input', () => {
        updateLines();
        localStorage.setItem('dd_v5_code', editor.value);
    });

    editor.addEventListener('scroll', () => { document.getElementById('ln-box').scrollTop = editor.scrollTop; });

    init();
</script>
</body>
</html>
