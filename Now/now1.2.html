<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ·±åº¦ä¸“æ³¨ - AI ææ•ˆå·¥å…·</title>
    <style>
        :root {
            --apple-blue: #007AFF;
            --eye-care-bg: #f5f5f7;
            --glass-bg: rgba(255, 255, 255, 0.72);
            --text-main: #1d1d1f;
            --text-sec: #86868b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, "SF Pro SC", "SF Pro Display", "PingFang SC", "Helvetica Neue", sans-serif;
            background: linear-gradient(125deg, #e3e3e8 0%, #f5f5f7 100%);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* é¡¶éƒ¨ç”¨æˆ·æ  */
        .user-bar {
            width: 100%;
            max-width: 500px;
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.04);
        }
        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        .user-info { margin-left: 12px; }
        .user-name { font-weight: 600; font-size: 16px; }

        /* ä¸»ä½“å¡ç‰‡ */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 40px 24px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.06);
            text-align: center;
            transition: transform 0.3s ease;
            position: relative;
        }

        h2 { font-size: 24px; font-weight: 600; margin-bottom: 20px; letter-spacing: -0.5px; }

        #task-display { 
            font-size: 18px; color: var(--apple-blue); font-weight: 500; 
            min-height: 28px; margin-bottom: 10px; word-break: break-all;
        }

        /* è¾“å…¥æ¡†å®¹å™¨ */
        .input-wrapper { position: relative; width: 100%; margin-bottom: 20px; }
        textarea {
            width: 100%; padding: 16px; border: none; border-radius: 16px;
            background: rgba(0,0,0,0.05); font-size: 16px; outline: none;
            resize: none; transition: all 0.2s; line-height: 1.5;
        }
        .clear-btn {
            position: absolute; right: 10px; top: 10px;
            background: #999; color: white; border-radius: 50%;
            width: 20px; height: 20px; line-height: 18px; font-size: 14px;
            cursor: pointer; display: none;
        }

        #timer-display {
            font-size: 72px; font-weight: 200; color: var(--text-main);
            font-variant-numeric: tabular-nums; margin: 30px 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .btn-group { display: flex; gap: 12px; }
        button {
            flex: 1; padding: 16px; border: none; border-radius: 16px;
            font-size: 17px; font-weight: 600; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .btn-start { background: var(--apple-blue); color: white; }
        .btn-reset { background: #ff3b30; color: white; display: none; }
        .btn-share { background: #34c759; color: white; margin-top: 12px; width: 100%; }
        button:active { transform: scale(0.96); opacity: 0.9; }

        /* Toast æ ·å¼ */
        #toast {
            position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 12px 24px;
            border-radius: 25px; z-index: 9999; display: none;
            font-size: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* é¡µè„šç‰ˆæƒ */
        footer {
            margin-top: auto; padding: 40px 20px; text-align: center;
            font-size: 13px; color: var(--text-sec); width: 100%;
        }
        .footer-links { margin: 15px 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .footer-links a { color: var(--apple-blue); text-decoration: none; }
        .copy-tag { background: #eee; padding: 2px 8px; border-radius: 4px; cursor: pointer; }

        /* åŠ¨ç”» */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass-card { animation: fadeIn 0.8s ease-out; }
    </style>
</head>
<body>

<div id="toast">æç¤ºä¿¡æ¯</div>

<div class="user-bar">
    <img src="https://profile-avatar.csdnimg.cn/22f8b0128b694047beb93057ddc0d7cc_kq8819.jpg!1" class="avatar" alt="å¤´åƒ">
    <div class="user-info">
        <div class="user-name">è‰¾å…œå…œå„¿</div>
        <div style="font-size: 12px; color: var(--text-sec);">æ­£åœ¨æ„å»ºä¸“æ³¨åŠ›...</div>
    </div>
</div>

<div class="glass-card">
    <h2 id="greeting">ç°åœ¨æ‰“å¼€æ‰‹æœºè¦å¹²å˜›ï¼Ÿ</h2>
    <div id="task-display"></div>
    
    <div class="input-wrapper">
        <textarea id="task-input" rows="2" placeholder="è¾“å…¥ç›®æ ‡ï¼ˆæ”¯æŒ Emoji âœ¨ï¼‰" oninput="handleInput(this)"></textarea>
        <div id="clear-btn" class="clear-btn" onclick="clearInput()">Ã—</div>
    </div>
    
    <div id="timer-display">25:00</div>
    
    <div class="btn-group">
        <button id="main-btn" class="btn-start" onclick="toggleTimer()">å¼€å¯æ·±åº¦ä¸“æ³¨</button>
        <button id="reset-btn" class="btn-reset" onclick="resetTimer()">æ”¾å¼ƒæœ¬æ¬¡</button>
    </div>
    
    <button class="btn-share" onclick="shareCard()">åˆ†äº«ä¸“æ³¨æˆå°±</button>

    <p style="margin-top: 25px; font-size: 13px; color: var(--text-sec); line-height: 1.6;">
        "ä¸“æ³¨æ˜¯æ‰€æœ‰å¤©æ‰çš„å…±åŒç‰¹å¾ã€‚"
    </p>
</div>

<footer>
    <div id="pv-count">æ­£åœ¨ç»Ÿè®¡æµè§ˆé‡...</div>
    <div class="footer-links">
        <a href="https://t.zsxq.com/7tSuP" target="_blank">æŠ€æœ¯æ”¯æŒï¼šè‰¾å…œå…œå„¿</a>
        <span class="copy-tag" onclick="copyQQ()">QQç¾¤: 857023577 (ç‚¹å‡»å¤åˆ¶)</span>
        <a href="https://t.zsxq.com/XNHXs" target="_blank">DeepSeekå®æˆ˜</a>
        <a href="https://t.zsxq.com/uqG2N" target="_blank">AIç¼–ç¨‹åšäº§å“</a>
        <a href="https://mp.weixin.qq.com/s/uHh9gx2sUMOOjIhKyIbx4A" target="_blank">æ›´å¤šå·¥å…·</a>
    </div>
    <div id="copyright">Â© <span id="year"></span> è‰¾å…œå…œå„¿ ç‰ˆæƒæ‰€æœ‰</div>
</footer>

<script>
    // åŸºç¡€çŠ¶æ€
    let timeLeft = 25 * 60;
    let timerId = null;
    let isRunning = false;

    // å…ƒç´ è·å–
    const toast = document.getElementById('toast');
    const taskInput = document.getElementById('task-input');
    const clearBtn = document.getElementById('clear-btn');
    const taskDisplay = document.getElementById('task-display');
    const mainBtn = document.getElementById('main-btn');
    const resetBtn = document.getElementById('reset-btn');

    // 1. åˆå§‹åŒ–åŠŸèƒ½
    window.onload = function() {
        updateYear();
        loadHistory();
        initTracking();
    };

    // 2. Toast æç¤ºé€»è¾‘
    function showToast(msg, duration = 2000) {
        toast.textContent = msg;
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, duration);
    }

    // 3. è¾“å…¥æ ¡éªŒä¸å¿«æ·æ¸…ç©º
    function handleInput(el) {
        clearBtn.style.display = el.value.length > 0 ? 'block' : 'none';
        // å®‰å…¨æ ¡éªŒï¼šè¿‡æ»¤æ½œåœ¨è„šæœ¬æ ‡ç­¾ï¼ˆåŸºç¡€ç‰ˆï¼‰
        el.value = el.value.replace(/<script.*?>.*?<\/script>/ig, '');
    }

    function clearInput() {
        taskInput.value = '';
        clearBtn.style.display = 'none';
        taskInput.focus();
    }

    // 4. å®šæ—¶å™¨æ ¸å¿ƒé€»è¾‘
    function toggleTimer() {
        if (!isRunning) {
            const task = taskInput.value.trim();
            if (!task) {
                showToast("âš ï¸ è¯·è¾“å…¥æ‚¨çš„ä¸“æ³¨ç›®æ ‡");
                return;
            }
            saveToLocal(task);
            startTimer(task);
        }
    }

    function startTimer(task) {
        isRunning = true;
        taskDisplay.textContent = "ğŸ¯ ä»»åŠ¡ä¸­ï¼š" + task;
        taskInput.parentElement.style.display = "none";
        resetBtn.style.display = "block";
        mainBtn.textContent = "ä¿æŒä¸“æ³¨ä¸­...";
        mainBtn.disabled = true;
        mainBtn.style.background = "#8e8e93";

        timerId = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerId);
                showToast("ğŸ‰ å¤ªæ£’äº†ï¼ä»»åŠ¡å®Œæˆï¼", 5000);
                resetTimer();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const mins = Math.floor(timeLeft / 60);
        const secs = timeLeft % 60;
        document.getElementById('timer-display').textContent = 
            `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function resetTimer() {
        clearInterval(timerId);
        isRunning = false;
        timeLeft = 25 * 60;
        updateTimerDisplay();
        taskInput.parentElement.style.display = "block";
        taskDisplay.textContent = "";
        resetBtn.style.display = "none";
        mainBtn.textContent = "å¼€å¯æ·±åº¦ä¸“æ³¨";
        mainBtn.disabled = false;
        mainBtn.style.background = "var(--apple-blue)";
    }

    // 5. æ•°æ®å­˜å‚¨
    function saveToLocal(task) {
        try {
            let history = JSON.parse(localStorage.getItem('focus_history') || '[]');
            history.unshift({time: new Date().toLocaleString(), task: task});
            
            // æ•°æ®è¿‡é‡æé†’ (æ¨¡æ‹Ÿ 2MB é™åˆ¶)
            if (JSON.stringify(history).length > 2000000) {
                showToast("å­˜å‚¨ç©ºé—´å°†æ»¡ï¼Œå·²æ¸…ç†æ—§æ•°æ®");
                history = history.slice(0, 100);
            }
            localStorage.setItem('focus_history', JSON.stringify(history));
        } catch (e) {
            console.error("å­˜å‚¨å¤±è´¥");
        }
    }

    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('focus_history') || '[]');
        if (history.length > 0) {
            console.log("æ¬¢è¿å›æ¥ï¼Œä¸Šæ¬¡ä»»åŠ¡ï¼š", history[0].task);
        }
    }

    // 6. åˆ†äº«åŠŸèƒ½ (è°ƒç”¨åŸç”Ÿ Web Share API)
    async function shareCard() {
        const task = taskInput.value || "ä¿æŒä¸“æ³¨";
        const shareData = {
            title: 'æˆ‘çš„æ·±åº¦ä¸“æ³¨æ—¶é—´',
            text: `æˆ‘æ­£åœ¨ä½¿ç”¨â€œæ·±åº¦ä¸“æ³¨â€å·¥å…·è¿›è¡Œä»»åŠ¡ï¼š${task}ã€‚å¿«æ¥ä¸€èµ·é«˜æ•ˆåŠå…¬ï¼`,
            url: window.location.href
        };
        try {
            if (navigator.share) {
                await navigator.share(shareData);
            } else {
                showToast("å¤åˆ¶é“¾æ¥æˆåŠŸï¼Œå¿«å»åˆ†äº«å§ï¼");
            }
        } catch (err) {
            showToast("åˆ†äº«å·²å–æ¶ˆ");
        }
    }

    // 7. ç‰ˆæƒä¸ç»Ÿè®¡
    function updateYear() {
        const currentYear = new Date().getFullYear();
        document.getElementById('year').textContent = currentYear > 2026 ? `2026-${currentYear}` : "2026";
    }

    function copyQQ() {
        const qq = "857023577";
        navigator.clipboard.writeText(qq).then(() => {
            showToast("âœ… QQç¾¤å·å·²å¤åˆ¶ï¼š" + qq);
        });
    }

    // 8. åŸ‹ç‚¹ç»Ÿè®¡æ¨¡æ‹Ÿ (å®é™…å»ºè®®æ¥å…¥ LeanCloud æˆ–ç™¾åº¦ç»Ÿè®¡)
    function initTracking() {
        let views = localStorage.getItem('site_views') || 0;
        views = parseInt(views) + 1;
        localStorage.setItem('site_views', views);
        document.getElementById('pv-count').textContent = `æœ¬é¡µæ€»è®¿é—®é‡ï¼š${views} (åŸºäºIPç»Ÿè®¡æ¨¡æ‹Ÿ)`;
    }
</script>

</body>
</html>
