<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ£è¯é­”æ³•æ˜Ÿç©ºè´ºå¡ - Jingle Bells</title>
    <style>
        :root {
            --gold: #ffd700;
            --red: #ff4d4d;
            --green: #2ecc71;
            --brown: #5d4037;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at center, #050b1a 0%, #000 100%);
            color: white;
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        /* é›ªèŠ±èƒŒæ™¯ */
        #snowCanvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* 3D èˆå° */
        .stage {
            position: relative;
            width: 100%;
            height: 100vh;
            perspective: 1500px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
        }

        /* æ—‹è½¬çš„ç³»ç»Ÿï¼ˆåŒ…å«æ ‘ã€æ˜Ÿæ˜Ÿã€æ ‘å¹²ã€ç¤¼ç‰©ï¼‰ */
        .tree-system {
            position: relative;
            transform-style: preserve-3d;
            animation: rotateScene 18s linear infinite;
            margin-top: -50px; /* å‘ä¸Šå¾®è°ƒ */
        }

        @keyframes rotateScene {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        /* æ ‘å°–çš„å¤§æ˜Ÿæ˜Ÿ */
        .top-star {
            position: absolute;
            top: -350px; /* å¯¹åº”å¤§æ ‘çš„é«˜åº¦ */
            left: -30px;
            width: 60px;
            height: 60px;
            background: var(--gold);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            box-shadow: 0 0 60px var(--gold);
            animation: starFlash 1.5s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes starFlash {
            0%, 100% { transform: scale(1); filter: brightness(1.2); }
            50% { transform: scale(1.3); filter: brightness(1.5); }
        }

        /* æ ‘å¹² */
        .trunk {
            position: absolute;
            top: 50px; /* ä½äºèºæ—‹æ ‘åº•éƒ¨ */
            left: -20px;
            width: 40px;
            height: 80px;
            background: linear-gradient(to right, #4e342e, #5d4037, #4e342e);
            border-radius: 5px;
            transform-style: preserve-3d;
        }

        /* èºæ—‹ç‚¹å’Œè£…é¥° */
        .dot {
            position: absolute;
            border-radius: 50%;
            transform-style: preserve-3d;
        }

        /* 3D ç¤¼ç‰©ç›’ï¼ˆåœ¨æ ‘å‘¨å›´ï¼‰ */
        .gift-3d {
            position: absolute;
            width: 40px;
            height: 40px;
            transform-style: preserve-3d;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .gift-3d:hover {
            transform: scale(1.3) !important;
        }

        .gift-side {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* ç¯ç»•æ–‡å­— */
        .wish-char {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            white-space: nowrap;
        }

        /* UI é¢æ¿ */
        .ui-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
        }

        .hint-text {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.3);
            pointer-events: none;
        }

        /* å¼¹çª— */
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal {
            background: #fff; color: #333; padding: 40px;
            border-radius: 20px; width: 350px; text-align: center;
        }
        .modal input {
            width: 100%; padding: 12px; margin: 20px 0;
            box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px;
        }
        .btn-send {
            background: var(--red); color: white; border: none;
            padding: 12px 30px; border-radius: 25px; cursor: pointer; font-weight: bold;
        }

        /* éŸ³ä¹æ§åˆ¶ */
        .music-toggle {
            position: fixed;
            top: 25px; right: 25px;
            width: 50px; height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 100; font-size: 24px;
        }
        .music-anim { animation: rotateScene 3s linear infinite; }
    </style>
</head>
<body>

<canvas id="snowCanvas"></canvas>

<!-- éŸ³ä¹ï¼šç»å…¸çš„ Jingle Bells -->
<div class="music-toggle" id="musicBtn" onclick="toggleMusic()">ğŸµ</div>
<audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    <!-- å¦‚æœä¸Šæ–¹åœ°å€å¤±æ•ˆï¼Œå¯æ›¿æ¢ä¸ºå…¶ä»–å…¬å¼€çš„ Jingle Bells MP3 åœ°å€ -->
</audio>

<div class="stage">
    <div class="tree-system" id="treeSystem">
        <!-- é¡¶éƒ¨åŒæ­¥æ—‹è½¬çš„æ˜Ÿæ˜Ÿ -->
        <div class="top-star"></div>
        
        <!-- æ ‘å¹² -->
        <div class="trunk"></div>

        <!-- 3D èºæ—‹ä¸»ä½“å°†ç”± JS ç”Ÿæˆ -->
        <div id="wishOrbit" style="transform-style: preserve-3d;"></div>
        
        <!-- 3D ç¤¼ç‰©ç›’å°†ç”± JS ç”Ÿæˆåœ¨æ ‘å‘¨å›´ -->
        <div id="giftsZone" style="transform-style: preserve-3d;"></div>
    </div>
</div>

<div class="ui-panel">
    <div class="hint-text">ç‚¹å‡»åº•éƒ¨çš„ç¤¼ç‰©ç›’ ğŸ å¯„é€ä½ çš„åœ£è¯å¿ƒæ„¿</div>
</div>

<!-- ç¥ç¦è¯­å¼¹çª— -->
<div class="overlay" id="overlay">
    <div class="modal">
        <h2 style="margin-top:0">ğŸ„ åˆ¶ä½œåœ£è¯è´ºå¡</h2>
        <p>è¾“å…¥ç¥ç¦è¯­ï¼Œç”Ÿæˆä¸“å±æ˜Ÿç©ºé“¾æ¥</p>
        <input type="text" id="wishInput" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„ç¥ç¦..." maxlength="25">
        <button class="btn-send" onclick="generateLink()">ç”Ÿæˆå¹¶å¤åˆ¶é“¾æ¥</button>
        <button class="btn-send" style="background:#888; margin-top:10px;" onclick="closeModal()">å–æ¶ˆ</button>
        <div id="linkResult" style="font-size: 11px; margin-top:15px; word-break: break-all; color:#666;"></div>
    </div>
</div>

<script>
    const treeSystem = document.getElementById('treeSystem');
    const giftsZone = document.getElementById('giftsZone');
    const wishOrbit = document.getElementById('wishOrbit');

    // 1. ç”Ÿæˆæ›´å¤§çš„èºæ—‹åœ£è¯æ ‘
    function buildTree() {
        const totalPoints = 450; // å¢åŠ ç‚¹æ•°ä½¿æ ‘æ›´èŒ‚å¯†
        for (let i = 0; i < totalPoints; i++) {
            const angle = i * 0.18;
            const y = i * 0.8 - 340; // æ ‘çš„é«˜åº¦
            const radius = i * 0.45; // æ ‘çš„å®½åº¦
            
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;

            const dot = document.createElement('div');
            dot.className = 'dot';
            const size = Math.random() * 4 + 2;
            dot.style.width = size + 'px';
            dot.style.height = size + 'px';
            
            // ç»¿è‰²å’Œé‡‘è‰²äº¤æ›¿
            const color = i % 7 === 0 ? 'var(--gold)' : 'var(--green)';
            dot.style.background = color;
            dot.style.boxShadow = `0 0 10px ${color}`;
            dot.style.transform = `translate3d(${x}px, ${y}px, ${z}px)`;
            
            treeSystem.appendChild(dot);
            
            // å¶å°”æ·»åŠ å¤§è£…é¥°çƒ
            if (i % 25 === 0) {
                const deco = document.createElement('div');
                deco.className = 'dot';
                deco.style.width = '10px';
                deco.style.height = '10px';
                deco.style.background = i % 50 === 0 ? 'white' : 'var(--red)';
                deco.style.transform = `translate3d(${x * 1.05}px, ${y}px, ${z * 1.05}px)`;
                treeSystem.appendChild(deco);
            }
        }
    }

    // 2. åœ¨æ ‘åº•å‘¨å›´ç”Ÿæˆ 3D ç¤¼ç‰©ç›’
    function buildGifts() {
        const colors = ['#e74c3c', '#3498db', '#f1c40f', '#9b59b6', '#e67e22'];
        for (let i = 0; i < 8; i++) {
            const angle = (i / 8) * Math.PI * 2;
            const radius = 120 + Math.random() * 50;
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            
            const gift = document.createElement('div');
            gift.className = 'gift-3d';
            gift.onclick = openModal;
            
            const color = colors[i % colors.length];
            // åˆ›å»ºç«‹æ–¹ä½“çš„ 6 ä¸ªé¢
            const faces = [
                `rotateX(0deg) translateZ(20px)`,
                `rotateX(180deg) translateZ(20px)`,
                `rotateY(90deg) translateZ(20px)`,
                `rotateY(-90deg) translateZ(20px)`,
                `rotateX(90deg) translateZ(20px)`,
                `rotateX(-90deg) translateZ(20px)`
            ];
            
            faces.forEach(f => {
                const face = document.createElement('div');
                face.className = 'gift-side';
                face.style.background = color;
                face.style.transform = f;
                // æ·»åŠ ä¸å¸¦æ•ˆæœ
                if (f.includes('rotateX(0deg)') || f.includes('rotateX(180deg)') || f.includes('rotateY')) {
                    const ribbon = document.createElement('div');
                    ribbon.style.position = 'absolute';
                    ribbon.style.left = '15px'; ribbon.style.width = '10px';
                    ribbon.style.height = '100%'; ribbon.style.background = 'var(--gold)';
                    face.appendChild(ribbon);
                }
                gift.appendChild(face);
            });

            gift.style.transform = `translate3d(${x}px, 60px, ${z}px)`;
            giftsZone.appendChild(gift);
        }
    }

    // 3. é›ªèŠ±æ•ˆæœ
    const canvas = document.getElementById('snowCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function initSnow() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        particles = Array.from({length: 120}, () => ({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            r: Math.random() * 3 + 1,
            d: Math.random() * 1 + 0.5
        }));
    }
    function drawSnow() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        particles.forEach(p => {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fill();
            p.y += p.d;
            if (p.y > canvas.height) p.y = -10;
        });
        requestAnimationFrame(drawSnow);
    }

    // 4. åˆ†äº«æ–‡æ¡ˆé€»è¾‘
    function displayWish() {
        const urlParams = new URLSearchParams(window.location.search);
        const msg = urlParams.get('msg');
        if (!msg) return;

        const text = decodeURIComponent(msg);
        wishOrbit.innerHTML = '';
        const chars = text.split('');
        chars.forEach((char, i) => {
            const span = document.createElement('div');
            span.className = 'wish-char';
            span.innerText = char;
            const angle = (i / chars.length) * Math.PI * 2;
            const radius = 220; // æ–‡å­—ç¯ç»•åŠå¾„
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            span.style.transform = `translate3d(${x}px, ${-150 + (i%2)*20}px, ${z}px) rotateY(${-angle}rad)`;
            wishOrbit.appendChild(span);
        });
    }

    // äº¤äº’å‡½æ•°
    function openModal() { document.getElementById('overlay').style.display = 'flex'; }
    function closeModal() { document.getElementById('overlay').style.display = 'none'; }

    function generateLink() {
        const input = document.getElementById('wishInput').value;
        if (!input) return alert('è¯·è¾“å…¥ä½ çš„ç¥æ„¿å†…å®¹');
        const url = window.location.origin + window.location.pathname + '?msg=' + encodeURIComponent(input);
        
        const res = document.getElementById('linkResult');
        res.innerHTML = `é“¾æ¥å·²ç”Ÿæˆï¼š<br>${url}`;
        
        navigator.clipboard.writeText(url).then(() => {
            alert('å¤åˆ¶æˆåŠŸï¼æŠŠé“¾æ¥å‘ç»™æœ‹å‹ï¼Œä»–ä»¬å°±èƒ½çœ‹åˆ°ä½ çš„æ˜Ÿç©ºç¥ç¦ã€‚');
            window.location.href = url; // ç«‹å³é¢„è§ˆ
        });
    }

    function toggleMusic() {
        const audio = document.getElementById('bgMusic');
        const btn = document.getElementById('musicBtn');
        if (audio.paused) {
            audio.play();
            btn.classList.add('music-anim');
        } else {
            audio.pause();
            btn.classList.remove('music-anim');
        }
    }

    // åˆå§‹åŒ–
    window.addEventListener('resize', initSnow);
    initSnow();
    drawSnow();
    buildTree();
    buildGifts();
    displayWish();
</script>

</body>
</html>