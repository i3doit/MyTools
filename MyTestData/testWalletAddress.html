<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoTest - æ·±åº¦æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
        }

        body { 
            font-family: 'Inter', -apple-system, system-ui, sans-serif; 
            background: var(--bg); 
            padding: 20px; 
            color: var(--text-main);
            line-height: 1.5;
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: var(--card-bg); 
            padding: 40px; 
            border-radius: 16px; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        
        /* é¡¶éƒ¨è­¦ç¤º */
        .warning-banner { 
            background: #fffbeb; 
            border: 1px solid #fde68a;
            padding: 16px; 
            margin-bottom: 30px; 
            border-radius: 12px; 
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .warning-banner .icon { font-size: 24px; }
        .warning-banner p { margin: 0; font-size: 14px; color: #92400e; }

        header { text-align: center; margin-bottom: 40px; }
        h1 { margin: 0; font-size: 28px; color: var(--text-main); font-weight: 800; letter-spacing: -0.5px; }
        .subtitle { color: var(--text-muted); margin-top: 8px; }

        /* æ§åˆ¶åŒº */
        .controls { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #f1f5f9; 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 24px; 
            gap: 20px;
        }
        .input-group { display: flex; align-items: center; gap: 12px; font-weight: 500; }
        input[type="number"] { 
            width: 70px; 
            padding: 10px; 
            border: 1px solid #cbd5e1; 
            border-radius: 8px;
            outline: none;
            transition: border 0.2s;
        }
        input[type="number"]:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        
        .btn-group { display: flex; gap: 10px; }
        .btn { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.2s; 
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        .btn-gen { background: var(--primary); color: white; }
        .btn-gen:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .btn-bug { background: #6366f1; color: white; }
        .btn-bug:hover { background: #4f46e5; }
        .btn-outline { background: white; border: 1px solid #cbd5e1; color: var(--text-main); }
        .btn-outline:hover { background: #f8fafc; }

        /* è¡¨æ ¼æ ·å¼ */
        .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid #e2e8f0; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #f8fafc; padding: 14px; text-align: left; font-size: 12px; color: var(--text-muted); text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        td { padding: 14px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        
        .addr-box { 
            font-family: 'JetBrains Mono', 'Consolas', monospace; 
            cursor: pointer; 
            padding: 6px 10px; 
            border-radius: 6px; 
            font-size: 13px;
            transition: all 0.2s;
            position: relative;
            display: block;
            border: 1px solid transparent;
        }
        .addr-box:hover { filter: brightness(0.95); transform: scale(1.01); }
        .addr-box::after { content: 'ç‚¹å‡»å¤åˆ¶'; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 10px; opacity: 0; transition: 0.2s; }
        .addr-box:hover::after { opacity: 0.6; }

        .addr-erc { background: #eff6ff; color: #1e40af; }
        .addr-trc { background: #ecfdf5; color: #065f46; }
        .addr-err { background: #fef2f2; color: #991b1b; border: 1px dashed #fecaca; }

        .tag { font-size: 11px; padding: 4px 8px; border-radius: 20px; font-weight: 600; }
        .tag-normal { background: #dcfce7; color: #166534; }
        .tag-err { background: #fee2e2; color: #991b1b; }

        /* Toast */
        #toast { 
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); 
            background: #1e293b; color: white; padding: 12px 24px; 
            border-radius: 12px; display: none; z-index: 1000; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }

        .test-cases { margin-top: 40px; padding-top: 30px; border-top: 1px solid #e2e8f0; }
        .test-cases h3 { font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .case-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
        .case-item { background: #f8fafc; padding: 16px; border-radius: 10px; border: 1px solid #e2e8f0; font-size: 13px; }
        .case-item b { color: var(--primary); display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

<div id="toast">å¤åˆ¶æˆåŠŸ</div>

<div class="container">
    <div class="warning-banner">
        <span class="icon">âš ï¸</span>
        <p><b>å®‰å…¨å£°æ˜ï¼š</b>ç”Ÿæˆçš„åœ°å€ä»…ç”¨äºå¼€å‘å’Œå‹åŠ›æµ‹è¯•ã€‚è¿™äº›åœ°å€ç”±éšæœºæ•°ç”Ÿæˆï¼Œ<b>ä¸æä¾›ç§é’¥</b>ã€‚ä¸¥ç¦å‘æ­¤ç±»åœ°å€å‘é€ä»»ä½•çœŸå®ä»·å€¼çš„ä»£å¸ï¼Œå¦åˆ™å°†å¯¼è‡´èµ„äº§æ°¸ä¹…ä¸¢å¤±ã€‚</p>
    </div>

    <header>
        <h1>åŒºå—é“¾åœ°å€æ·±åº¦æµ‹è¯•ç”Ÿæˆå™¨</h1>
        <p class="subtitle">é’ˆå¯¹ TRC20 (Base58Check) ä¸ ERC20 (Hex) çš„å…¨åœºæ™¯æ¨¡æ‹Ÿ</p>
    </header>

    <div class="controls">
        <div class="input-group">
            <span>ç”Ÿæˆæ•°é‡</span>
            <input type="number" id="count" value="5" min="1" max="100">
            <button class="btn btn-gen" onclick="generateBatch(false)">âœ¨ ç”Ÿæˆæ­£å¸¸</button>
            <button class="btn btn-bug" onclick="generateBatch(true)">ğŸ› ï¸ æ¨¡æ‹Ÿå¼‚å¸¸</button>
        </div>
        <div class="btn-group">
            <button class="btn btn-outline" onclick="exportData()">ğŸ“Š å¯¼å‡º Excel</button>
            <button class="btn btn-outline" onclick="reset()">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th style="width: 80px;">åºå·</th>
                    <th style="width: 140px;">æ•°æ®ç±»å‹</th>
                    <th>ä»¥å¤ªåŠ (ERC-20/Hex)</th>
                    <th>æ³¢åœº (TRC-20/Base58)</th>
                </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
    </div>

    <div class="test-cases">
        <h3>ğŸ” è‡ªåŠ¨åŒ–æµ‹è¯•ç‚¹å»ºè®®</h3>
        <div class="case-grid">
            <div class="case-item"><b>ç®—æ³•éªŒè¯</b>åç«¯å¿…é¡»é€šè¿‡åŒå±‚ SHA256 éªŒè¯ Base58Check æ ¡éªŒå’Œï¼Œè€Œéç®€å•çš„é•¿åº¦åˆ¤æ–­ã€‚</div>
            <div class="case-item"><b>å¼‚å¸¸å®¹é”™</b>å½“è¾“å…¥åŒ…å« "0, O, I, l" ç­‰æ˜“æ··æ·†å­—ç¬¦æ—¶ï¼Œå‰ç«¯åº”åœ¨è¾“å…¥é˜¶æ®µå³åˆ»é˜»æ–­ã€‚</div>
            <div class="case-item"><b>å‰ç¼€è¯†åˆ«</b>TRON ä¸»ç½‘åœ°å€å¿…é¡»ä»¥ 'T' (0x41) å¼€å¤´ï¼Œæµ‹è¯•ç¯å¢ƒå¯èƒ½æ”¯æŒå…¶å®ƒå‰ç¼€ã€‚</div>
            <div class="case-item"><b>é•¿åº¦è¾¹ç•Œ</b>Base58 è§£ç åå¿…é¡»å›ºå®šä¸º 25 å­—èŠ‚ï¼ˆ1å‰ç¼€+20å“ˆå¸Œ+4æ ¡éªŒå’Œï¼‰ã€‚</div>
        </div>
    </div>
</div>

<script>
    const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
    let db = [];

    // --- åŠ å¯†é€»è¾‘ ---
    function encodeBase58(buffer) {
        let digits = [0];
        for (let i = 0; i < buffer.length; i++) {
            for (let j = 0; j < digits.length; j++) digits[j] <<= 8;
            digits[0] += buffer[i];
            let carry = 0;
            for (let j = 0; j < digits.length; j++) {
                digits[j] += carry; carry = (digits[j] / 58) | 0; digits[j] %= 58;
            }
            while (carry) { digits.push(carry % 58); carry = (carry / 58) | 0; }
        }
        for (let i = 0; buffer[i] === 0 && i < buffer.length - 1; i++) digits.push(0);
        return digits.reverse().map(d => ALPHABET[d]).join('');
    }

    async function getChecksum(payload) {
        const h1 = await crypto.subtle.digest('SHA-256', payload);
        const h2 = await crypto.subtle.digest('SHA-256', h1);
        return new Uint8Array(h2).slice(0, 4);
    }

    // --- æ ¸å¿ƒç”Ÿæˆå™¨ ---
    async function createTRC20(isError = false) {
        const prefix = 0x41; // 'T'
        const body = crypto.getRandomValues(new Uint8Array(20));
        let payload = new Uint8Array([prefix, ...body]);
        
        if(isError) {
            const types = ['ChecksumErr', 'PrefixErr', 'LengthErr', 'InvalidChar'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if(type === 'ChecksumErr') {
                const realSum = await getChecksum(payload);
                realSum[0] ^= 0xFF; 
                return { addr: encodeBase58(new Uint8Array([...payload, ...realSum])), msg: 'æ ¡éªŒå’Œé”™è¯¯' };
            } else if(type === 'PrefixErr') {
                const badPayload = new Uint8Array([0x66, ...body]); 
                const sum = await getChecksum(badPayload);
                return { addr: encodeBase58(new Uint8Array([...badPayload, ...sum])), msg: 'å‰ç¼€é”™è¯¯' };
            } else if(type === 'LengthErr') {
                const shortPayload = new Uint8Array([prefix, ...body.slice(0,17)]); 
                const sum = await getChecksum(shortPayload);
                return { addr: encodeBase58(new Uint8Array([...shortPayload, ...sum])), msg: 'é•¿åº¦å¼‚å¸¸' };
            } else {
                let normal = encodeBase58(new Uint8Array([...payload, await getChecksum(payload)]));
                return { addr: normal.slice(0,-2) + '0O', msg: 'éæ³•å­—ç¬¦(0/O)' };
            }
        }

        const checksum = await getChecksum(payload);
        return { addr: encodeBase58(new Uint8Array([...payload, ...checksum])), msg: 'æ­£å¸¸æ•°æ®' };
    }

    // --- UI æ§åˆ¶ ---
    async function generateBatch(isError) {
        const num = Math.min(parseInt(document.getElementById('count').value) || 5, 100);
        const newItems = [];
        for (let i = 0; i < num; i++) {
            const trcObj = await createTRC20(isError);
            const erc = '0x' + Array.from(crypto.getRandomValues(new Uint8Array(20)), b => b.toString(16).padStart(2,'0')).join('');
            newItems.push({
                id: db.length + i + 1,
                status: isError ? 'å¼‚å¸¸' : 'æ­£å¸¸',
                type: trcObj.msg,
                erc: erc,
                trc: trcObj.addr
            });
        }
        db = [...newItems.reverse(), ...db];
        render();
    }

    function render() {
        const tbody = document.getElementById('list');
        tbody.innerHTML = db.map(item => `
            <tr>
                <td style="color:#94a3b8; font-size:12px;">#${item.id}</td>
                <td><span class="tag ${item.status === 'æ­£å¸¸' ? 'tag-normal' : 'tag-err'}">${item.type}</span></td>
                <td><span class="addr-box addr-erc" onclick="copy('${item.erc}', this)">${item.erc}</span></td>
                <td><span class="addr-box ${item.status === 'æ­£å¸¸' ? 'addr-trc' : 'addr-err'}" onclick="copy('${item.trc}', this)">${item.trc}</span></td>
            </tr>
        `).join('');
    }

    function copy(text, el) {
        navigator.clipboard.writeText(text);
        const toast = document.getElementById('toast');
        toast.innerText = "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿";
        toast.style.display = 'block';
        
        // è§†è§‰åé¦ˆ
        const originalBg = el.style.background;
        el.style.background = "#cbd5e1";
        setTimeout(() => { 
            toast.style.display = 'none'; 
            el.style.background = originalBg;
        }, 1000);
    }

    function reset() { 
        if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
            db = []; 
            render(); 
        }
    }

    function exportData() {
        if(db.length === 0) return alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
        const exportDb = db.map(item => ({
            "åºå·": item.id,
            "æµ‹è¯•ç±»å‹": item.type,
            "ERC20åœ°å€": item.erc,
            "TRC20åœ°å€": item.trc,
            "çŠ¶æ€": item.status
        }));
        const ws = XLSX.utils.json_to_sheet(exportDb);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
        XLSX.writeFile(wb, `Test_Data_${new Date().getTime()}.xlsx`);
    }

    window.onload = () => generateBatch(false);
</script>
</body>
</html>
